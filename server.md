# Необходимый функционал серверной части

1. При открытии страницы отправляется GET запрос. Нужно ответить списком комнат с ключами:

  * "roomId": генерируемый, при создании комнаты, уникальный id комнаты
  * "host": имя хоста
  * "guests": массив с количеством гостей.

2. При создании новой комнаты отправляется POST запрос с именем хоста, сгенерированным уникальным id и паролем. Данные о новой комнате ("host", "guests" в виде пустого массива, "roomId", "password") добавляются в список комнат. В ответе присылаются данные о созданной комнате("roomId", "host", "guests", "password").

3. При подключении к уже существующей комнате отправляется POST запрос с именем гостя, и при наличии, паролем. При совпадении веденного пароля с паролем комнаты, необходимо добавить веденное имя гостя в "guests" данной комнаты. В ответе присылаются данные о комнате: "host", "guests", "roomId".

Данные о комнатах на сервере могу храниться в виде массива объектов:

`    

    [
      { 
        "roomId": id1,
        "host": host1,
        "password": 123,
        "guests": [
          {
            "name": guest1,
            "pointer": 543
          },
          {
            "name": guest2,
            "pointer": 542
          }
        ] 
      },
      { 
        "roomId": id2,
        "host": host2,
        "password": qwe,
        "guests": [
          {
            "name": guest1,
            "pointer": 123
          },
          {
            "name": guest2,
            "pointer": 121
          }
        ]
      }
    ]
    
`

4. После получения ответа от сервера, при создании либо подключении к комнате, открывается WebSocket соединение. Если открывается хостом(то есть создана новая комната), то на сервере создается список, в котором будут содержаться все действия над холстом. При открытии гостем, ему отсылается список со всеми действиями над холстом(для отрисовки уже созданного к тому моменту изображения). Данные могут быть представленны в виде:

* Массив комнат, с ключами в виде id комнаты, значения по каждому ключу - массив действий над холстом в данной комнате.

* Каждое действие - объект, ключами и значениями являются:

  1. Действие над холстом - ключ, например moveto. Его значение - массив аргументов для данного действия, x и y для moveto.

  2. Указатель на данное действие, случайное уникальное значение.

`    

    {
      roomId1: [
        { 
          "moveto": [x, y],
          "pointer": value1 
        },
        { 
          "lineto": [x, y],
          "pointer": value2 
        }
      ],
      roomId2: [
      ]
    }
    
`


5. При внесении изменений на холсте, данные, в виде, упорядоченного по порядку внесения изменений, массива, передаются через ws, их  необходимо добавить в список действий над холстом c id данной комнаты, сохраняя порядок.

6. Пользователи уже находящиеся в комнате, получают по ws от сервера
только последние, не полученные изменения из списка. Определяется по указателю, в объекте гостя, при наличии в массиве действий над холстом после данного указателя, все действия после него отсылаются пользователю.

7. При удалении комнаты хостом, либо при выходе последнего участника, при закрытии последнего ws соединения, данные о комнате и холсте из списков удаляются.