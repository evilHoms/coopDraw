{"version":3,"sources":["webpack:///bundle.js","webpack:///webpack/bootstrap ab31f8aec0c5d07ef9c5","webpack:///./src/request/request.js","webpack:///./config.json","webpack:///./src/app.js","webpack:///./src/room/room.js","webpack:///./src/popup/popup.js","webpack:///./src/notice/notice.js","webpack:///./src/canvas/canvas.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_classCallCheck","instance","Constructor","TypeError","value","_createClass","defineProperties","target","props","length","descriptor","writable","key","protoProps","staticProps","Requests","this","url","Promise","resolve","reject","fetch","then","res","json","host","pass","arguments","undefined","form","FormData","append","base","rooms","document","querySelectorAll","isUnick","randomEnding","Math","round","random","forEach","el","dataset","roomId","method","body","guest","console","log","userId","image","fetchOpts","status","catch","imageId","data","callback","_this","keepConnection","hostname","localhost","buildRooms","wrapper","textContent","room","roomEl","_room","Room","users","onConnectClick","appendChild","e","preventDefault","currentTarget","classList","contains","popup","_popup","Popup","onPopupSubmitClick","root","querySelector","focus","onNewRoomBtnClick","newRoomPopup","type","_request","newRoom","requestUrl","add","editor","_canvas","Canvas","er","connectRoom","msg","notice","_notice","Notice","background","parentElement","removeChild","_config","_config2","obj","default","location","newRoomBtn","roomsList","getRooms","addEventListener","hostName","guestsCount","eventHandler","updateRoom","createElement","guests","connect","eventHendler","submitButton","createPopup","code","click","submitBtn","disabled","main","title","nameWrapper","nameLabel","setAttribute","nameInput","id","passWrapper","passLabel","passInput","onNameInput","bind","onEnterPress","text","state","createNotice","addListeners","connectionUrl","editorElement","userName","isHost","ableToDraw","loader","buffer","pathBuffer","isQueue","connectionOpts","clearCanvas","ws","send","canvasToImage","canvasBuffer","Image","canvas","ctx","getContext","canvasWidth","window","innerWidth","canvasHeight","innerHeight","canvasSizeDif","drawOpts","isFirstPoint","isLastPoint","tool","current","coords","x1","y1","x2","y2","xCur","yCur","options","lineJoin","lineCap","lineWidth","strokeStyle","fillStyle","backgroundColor","connection","setListeners","JSON","parse","event","src","pic","mask","remove","close","deleteRoom","disconnectRoom","init","self","_this2","cleared","drawImage","drawBuffered","splice","toBlob","blob","URL","createObjectURL","buildUsersPanel","buildAsideMenu","initCanvas","onControllBtnClick","btn","exit","_this3","panel","usersWrapper","buildUser","userPanelControlls","closeBtn","clearBtn","user","controlls","permissions","permissionTitle","permissionStatus","style","opacity","addAsideElement","element","onToolClick","addSettingElement","settingElement","onSettingClick","lineWidthPoint","widthInput","lineWidthInputHandler","pointView","lastItemPattern","test","width","slice","aside","showOptionMenu","_this4","tools","push","settings","toolsWrapper","settingsWrapper","showHideArrow","option","onBtnClick","currentOptionBtn","setOption","optionInput","onOptionInput","currentColor","border","isValid","okBtn","getElementById","usersMenu","colors","colorsWrapper","color","colorsPopup","cansel","currentColorLable","getBoundingClientRect","y","parseFloat","getComputedStyle","height","offsetHeight","onCanvasResize","onMouseDown","onMouseMove","canvasBoundingRect","pageX","x","pageY","draw","onMouseUp","removeEventListener","_this5","left","newImage","setImageId","WebSocket","currentUsers","newUsers","clearRect","drawPoint","drawLine","drawRect","drawEllipse","drawTriangle","erase","pos","beginPath","moveTo","lineTo","stroke","isPath","rect","fill","closePath","ellipse","dx","dy","PI","save","globalCompositeOperation","restore","context","strokeWidth","setCtxOpts","actions","abs"],"mappings":"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","file":"bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 2);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Requests = exports.Requests = function () {\n  function Requests() {\n    _classCallCheck(this, Requests);\n  }\n\n  _createClass(Requests, null, [{\n    key: 'getRooms',\n    value: function getRooms(url) {\n      return new Promise(function (resolve, reject) {\n        fetch(url).then(function (res) {\n          return res.json();\n        }).then(function (res) {\n          resolve(res);\n        });\n      });\n    }\n  }, {\n    key: 'newRoom',\n    value: function newRoom(url, host) {\n      var pass = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n      //Request to adding new room\n      return new Promise(function (resolve, reject) {\n        var form = new FormData();\n        form.append('host', host);\n        form.append('password', pass);\n        form.append('roomId', generateRandomRoomId('room'));\n\n        fetch(url, {\n          method: 'POST',\n          body: form\n        }).then(function (res) {\n          return res.json();\n        }).then(function (res) {\n          resolve(res);\n        });\n\n        function generateRandomRoomId(base) {\n          var rooms = document.querySelectorAll('.room');\n          var isUnick = void 0;\n          var randomEnding = void 0;\n\n          do {\n            isUnick = true;\n            randomEnding = Math.round(Math.random() * 10000);\n            rooms.forEach(function (el) {\n              if (el.dataset.roomId === base + randomEnding) isUnick = false;\n            });\n          } while (!isUnick);\n\n          return base + randomEnding;\n        }\n      });\n    }\n  }, {\n    key: 'connectRoom',\n    value: function connectRoom(url, guest, roomId) {\n      var pass = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n      //Request to connect the room\n      return new Promise(function (resolve, reject) {\n        var form = new FormData();\n        form.append('name', guest);\n        form.append('password', pass);\n        form.append('action', 'connect');\n        form.append('roomId', roomId);\n        console.log(url);\n        fetch(url, {\n          method: 'PUT',\n          body: form\n        }).then(function (res) {\n          return res.json();\n        }).then(function (res) {\n          resolve(res);\n        });\n      });\n    }\n  }, {\n    key: 'disconnectRoom',\n    value: function disconnectRoom(url, roomId, userId) {\n      //Request to disconnect the room\n      return new Promise(function (resolve, reject) {\n        var form = new FormData();\n        form.append('userId', userId);\n        form.append('action', 'disconnect');\n        form.append('roomId', roomId);\n        console.log(url);\n        fetch(url, {\n          method: 'PUT',\n          body: form\n        }).then(function (res) {\n          return res.json();\n        }).then(function (res) {\n          resolve(res);\n        });\n      });\n    }\n  }, {\n    key: 'deleteRoom',\n    value: function deleteRoom(url, roomId) {\n      //Request to delete the room\n      return new Promise(function (resolve, reject) {\n        var form = new FormData();\n        form.append('roomId', roomId);\n        console.log(url);\n        fetch(url, {\n          method: 'DELETE',\n          body: form\n        }).then(function (res) {\n          return res.json();\n        }).then(function (res) {\n          resolve(res);\n        });\n      });\n    }\n  }, {\n    key: 'newImage',\n    value: function newImage(url, image, name) {\n      // Посылаем POST запрос на сервер http://neto-api.herokuapp.com/pic\n      // Content-Type: multipart/form-data\n      // Тело запроса - формдата, с полями title, image(название, изображение)\n      // В ответе приходит id изображения, записать в imageId конкретной комнаты\n      // Можно делать данный запрос и передавать в канву в app.js\n      return new Promise(function (resolve, reject) {\n        var form = new FormData();\n        form.append('title', name);\n        form.append('image', image);\n        var fetchOpts = {\n          method: 'POST',\n          body: form\n        };\n        fetch(url, fetchOpts).then(function (res) {\n          if (res.status === 200) return res.json();else reject(res);\n        }).then(function (res) {\n          console.log(res);\n          resolve(res);\n        }).catch(reject);\n      });\n    }\n  }, {\n    key: 'setImageId',\n    value: function setImageId(url, roomId, imageId) {\n      return new Promise(function (resolve, reject) {\n        var data = new FormData();\n        data.append('roomId', roomId);\n        data.append('imageId', imageId);\n        // const data = JSON.stringify({\n        //   roomId: roomId,\n        //   imageId: imageId\n        // });\n        var fetchOpts = {\n          method: 'PATCH',\n          body: data\n        };\n        fetch(url, fetchOpts).then(function (res) {\n          return res.json();\n        }).then(resolve).catch(reject);\n      });\n    }\n  }, {\n    key: 'keepConnection',\n    value: function keepConnection(props, callback) {\n      var _this = this;\n\n      var url = props.url,\n          roomId = props.roomId,\n          userId = props.userId;\n\n      if (props.keepConnection) {\n        return new Promise(function (resolve, reject) {\n          console.log('connection request was sent');\n          fetch(url + '?roomId=' + roomId + '&userId=' + userId).then(function (res) {\n            return res.json();\n          }).then(function (res) {\n            _this.keepConnection(props, callback);\n            return res;\n          }).then(callback).catch(reject);\n        });\n      }\n    }\n  }]);\n\n  return Requests;\n}();\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\nmodule.exports = {\"hostname\":\"https://afternoon-cove-50884.herokuapp.com\",\"localhost\":\"http://localhost:8080\"}\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n__webpack_require__(3);\n\nvar _room = __webpack_require__(4);\n\nvar _request = __webpack_require__(0);\n\nvar _popup = __webpack_require__(6);\n\nvar _notice = __webpack_require__(8);\n\nvar _canvas = __webpack_require__(10);\n\nvar _config = __webpack_require__(1);\n\nvar _config2 = _interopRequireDefault(_config);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Адрес один, тк различаются типом запроса GET POST DELETE\nvar hostname = location.hostname === 'localhost' ? 'http://localhost:3000' : _config2.default.hostname;\nvar requestUrl = hostname + '/rooms';\nconsole.log(requestUrl);\n\nvar root = document.querySelector('#root');\nvar newRoomBtn = document.querySelector('.new-room--btn');\nvar roomsList = document.querySelector('.rooms__list');\nvar editor = null;\n\n_request.Requests.getRooms(requestUrl).then(function (res) {\n  if (res.length) {\n    console.log(res);\n    buildRooms(roomsList, res);\n  } else {\n    document.querySelector('.rooms__title').textContent = 'No Rooms';\n  }\n}).catch(function (er) {\n  return console.log(er);\n});\n\nnewRoomBtn.addEventListener('click', onNewRoomBtnClick);\n\nfunction buildRooms(wrapper, rooms) {\n  wrapper.textContent = '';\n  rooms.forEach(function (room) {\n    var roomEl = new _room.Room(room.host, room.roomId, room.users.length - 1, onConnectClick);\n    wrapper.appendChild(roomEl.room);\n  });\n}\n\nfunction onConnectClick(e) {\n  e.preventDefault();\n  var roomId = e.currentTarget.dataset.roomId;\n  if (!e.target.classList.contains('room__connect--btn')) return;\n\n  var popup = new _popup.Popup('connectRoom', onPopupSubmitClick, roomId);\n  root.appendChild(popup.popup);\n  document.querySelector('.popup').querySelector('input').focus();\n}\n\nfunction onNewRoomBtnClick(e) {\n  e.preventDefault();\n  var newRoomPopup = new _popup.Popup('newRoom', onPopupSubmitClick);\n  root.appendChild(newRoomPopup.popup);\n  document.querySelector('.popup').querySelector('input').focus();\n}\n\nfunction onPopupSubmitClick(e) {\n  e && e.preventDefault();\n  if (!e.target.classList.contains('popup__submit--btn')) return;\n\n  var name = this.querySelector('#nameInput').value;\n  var pass = this.querySelector('#passInput').value;\n  console.log(name, pass);\n\n  if (this.dataset.type === 'newRoom') {\n    //if (name.length > 0) {\n    _request.Requests.newRoom(requestUrl, name, pass)\n    //Создается объект canvas\n    .then(function (res) {\n      document.querySelector('.rooms').classList.add('hidden');\n      document.querySelector('.controlls').classList.add('hidden');\n      console.log(res.userId);\n      editor = new _canvas.Canvas(document.querySelector('.editor'), res.host, res.users, name, true, res.roomId, res.userId);\n    }).catch(function (er) {\n      return console.log(er);\n    });\n    //}\n    //else {\n    //  const notice = new Notice('Empty name', 'You must enter \"Name\" field');\n    //  root.appendChild(notice.notice);\n    //}\n  } else if (this.dataset.type === 'connectRoom') {\n    var roomId = e.currentTarget.dataset.roomId;\n    console.log(roomId);\n    _request.Requests.connectRoom(requestUrl, name, roomId, pass)\n    //Создается объект canvas\n    .then(function (res) {\n      console.log(res);\n      if (res.msg === 'denied') {\n        console.log('Access denied');\n        var notice = new _notice.Notice('Access denied', 'Wrong password');\n        root.appendChild(notice.notice);\n      } else {\n        document.querySelector('.rooms').classList.add('hidden');\n        document.querySelector('.controlls').classList.add('hidden');\n        editor = new _canvas.Canvas(document.querySelector('.editor'), res.host, res.users, name, false, roomId, res.userId, res.imageId, res.background);\n      }\n    }).catch(function (er) {\n      return console.log(er);\n    });\n  }\n\n  this.parentElement.removeChild(this);\n}\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Room = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n__webpack_require__(5);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Room = exports.Room = function () {\n  function Room(hostName, roomId, guestsCount, eventHandler) {\n    _classCallCheck(this, Room);\n\n    this.hostName = hostName;\n    this.guestsCount = guestsCount;\n    this.roomId = roomId;\n    this.room = null;\n    this.updateRoom(this.guestsCount);\n    this.room.addEventListener('click', eventHandler);\n  }\n\n  _createClass(Room, [{\n    key: 'updateRoom',\n    value: function updateRoom(guestsCount) {\n      var _this = this;\n\n      this.guestsCount = guestsCount;\n\n      this.room = function () {\n        var room = document.createElement('div');\n        room.classList.add('room');\n        room.dataset.roomId = _this.roomId;\n\n        var host = document.createElement('div');\n        host.classList.add('room__host');\n        host.textContent = 'Host: ' + _this.hostName;\n\n        var guests = document.createElement('div');\n        guests.classList.add('room__guests');\n        guests.textContent = 'Guests: ' + _this.guestsCount;\n\n        var connect = document.createElement('button');\n        connect.classList.add('room__connect--btn');\n        connect.textContent = 'Connect';\n\n        room.appendChild(host);\n        room.appendChild(guests);\n        room.appendChild(connect);\n\n        return room;\n      }();\n    }\n  }]);\n\n  return Room;\n}();\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Popup = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n__webpack_require__(7);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Popup = exports.Popup = function () {\n  function Popup(type, eventHendler, roomId) {\n    _classCallCheck(this, Popup);\n\n    this.type = type;\n    this.popup = null;\n    this.roomId = roomId;\n    this.submitButton = null;\n    this.createPopup();\n    this.popup.addEventListener('click', eventHendler);\n  }\n\n  _createClass(Popup, [{\n    key: 'onEnterPress',\n    value: function onEnterPress(e) {\n      if (e.code === 'Enter') {\n        this.submitButton.click();\n      }\n    }\n  }, {\n    key: 'onNameInput',\n    value: function onNameInput(e, submitBtn) {\n      this.submitButton.disabled = false;\n      e.currentTarget.value === '' && (this.submitButton.disabled = true);\n    }\n  }, {\n    key: 'createPopup',\n    value: function createPopup() {\n      var _this = this;\n\n      this.popup = function () {\n        var popup = document.createElement('div');\n        popup.classList.add('popup');\n        popup.dataset.type = _this.type;\n        popup.dataset.roomId = _this.roomId;\n\n        var main = document.createElement('div');\n        main.classList.add('popup__main');\n\n        var title = document.createElement('h3');\n        title.classList.add('popup__title');\n        if (_this.type === 'newRoom') {\n          title.textContent = 'Creating New Room';\n        } else if (_this.type === 'connectRoom') {\n          title.textContent = 'Connecting The Room';\n        }\n\n        var nameWrapper = document.createElement('div');\n        nameWrapper.classList.add('input-wrapper');\n        var nameLabel = document.createElement('label');\n        nameLabel.classList.add('popup__label');\n        nameLabel.setAttribute('for', 'nameInput');\n        nameLabel.textContent = 'Name: ';\n        var nameInput = document.createElement('input');\n        nameInput.classList.add('popup__input');\n        nameInput.id = 'nameInput';\n        nameWrapper.appendChild(nameLabel);\n        nameWrapper.appendChild(nameInput);\n\n        var passWrapper = document.createElement('div');\n        passWrapper.classList.add('input-wrapper');\n        var passLabel = document.createElement('label');\n        passLabel.classList.add('popup__label');\n        passLabel.setAttribute('for', 'passInput');\n        passLabel.textContent = 'Password: ';\n        var passInput = document.createElement('input');\n        passInput.classList.add('popup__input');\n        passInput.id = 'passInput';\n        passWrapper.appendChild(passLabel);\n        passWrapper.appendChild(passInput);\n\n        var submitButton = document.createElement('button');\n        submitButton.classList.add('popup__submit--btn');\n        submitButton.textContent = 'submit';\n        submitButton.disabled = true;\n        _this.submitButton = submitButton;\n\n        nameInput.addEventListener('input', _this.onNameInput.bind(_this));\n        popup.addEventListener('keyup', _this.onEnterPress.bind(_this));\n\n        main.appendChild(title);\n        main.appendChild(nameWrapper);\n        main.appendChild(passWrapper);\n        main.appendChild(submitButton);\n        popup.appendChild(main);\n\n        return popup;\n      }();\n    }\n  }]);\n\n  return Popup;\n}();\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Notice = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n__webpack_require__(9);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Notice = function () {\n  function Notice(title, text) {\n    _classCallCheck(this, Notice);\n\n    this.state = 'appearing';\n    this.title = title;\n    this.text = text;\n    this.notice = this.createNotice();\n    this.addListeners();\n  }\n\n  _createClass(Notice, [{\n    key: 'createNotice',\n    value: function createNotice() {\n      var notice = document.createElement('section');\n      notice.classList.add('notice');\n      notice.classList.add('notice-appearing');\n      var title = document.createElement('h3');\n      title.classList.add('notice-title');\n      title.textContent = this.title;\n      var text = document.createElement('p');\n      text.classList.add('notice-text');\n      text.textContent = this.text;\n      notice.appendChild(title);\n      notice.appendChild(text);\n      return notice;\n    }\n  }, {\n    key: 'addListeners',\n    value: function addListeners() {\n      var _this = this;\n\n      this.notice.addEventListener('animationend', function (e) {\n        if (_this.state === 'appearing') {\n          _this.notice.classList.add('notice-hiding');\n          _this.state = 'hiding';\n        } else {\n          _this.notice.parentElement.removeChild(_this.notice);\n          _this.notice = null;\n        }\n      });\n    }\n  }]);\n\n  return Notice;\n}();\n\nexports.Notice = Notice;\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Canvas = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _request = __webpack_require__(0);\n\n__webpack_require__(11);\n\nvar _config = __webpack_require__(1);\n\nvar _config2 = _interopRequireDefault(_config);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar hostname = location.hostname === 'localhost' ? 'http://localhost:3000' : _config2.default.hostname;\nvar requestUrl = hostname + '/rooms';\nvar connectionUrl = hostname + '/connection';\nvar imageUrl = 'https://neto-api.herokuapp.com/pic';\nvar wsUrl = 'wss://neto-api.herokuapp.com/pic';\n\nvar Canvas = exports.Canvas = function () {\n  function Canvas(editorElement, host, users, userName, isHost, roomId, userId) {\n    var _this = this;\n\n    var imageId = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : null;\n    var background = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : '#fff';\n\n    _classCallCheck(this, Canvas);\n\n    this.editor = editorElement;\n    this.host = host;\n    this.users = users;\n    this.userName = userName;\n    this.isHost = isHost;\n    this.ableToDraw = true;\n    this.roomId = roomId;\n    this.userId = userId;\n    this.imageId = imageId;\n    this.loader = document.querySelector('.canvas-loader');\n    this.buffer = [];\n    //this.lastBufferItem = null;\n    this.pathBuffer = [];\n    this.isQueue = false;\n    this.connectionOpts = {\n      url: connectionUrl,\n      roomId: this.roomId,\n      userId: this.userId,\n      keepConnection: true\n    };\n    this.image = this.editor.querySelector('.editor__image');\n    this.image.addEventListener('load', function (e) {\n      _this.clearCanvas();\n      console.log('loaded new image');\n      if (_this.buffer.length > 1) {\n        _this.ws.send(_this.image);\n        console.log('img load send');\n      } else {\n        _this.canvasToImage(_this, false, _this.image);\n        _this.isQueue = false;\n      }\n    });\n    this.canvasBuffer = new Image();\n    //this.editor.appendChild(this.canvasBuffer);\n    this.canvas = this.editor.querySelector('#canvas');\n    this.ctx = canvas.getContext('2d');\n    this.canvasWidth = window.innerWidth;\n    this.canvasHeight = window.innerHeight * 91 / 100;\n    this.canvasSizeDif = this.canvasWidth / this.canvasHeight;\n    console.log(this.canvasSizeDif);\n    this.drawOpts = {\n      isFirstPoint: true,\n      isLastPoint: false\n    };\n    this.tool = {\n      current: 'pen'\n    };\n    this.coords = {\n      x1: null,\n      y1: null,\n      x2: null,\n      y2: null,\n      xCur: null,\n      yCur: null\n    };\n    this.options = {\n      lineJoin: 'round',\n      lineCap: 'round',\n      lineWidth: 10,\n      strokeStyle: '#000',\n      fillStyle: '#999',\n      backgroundColor: background\n    };\n    this.ws = {\n      url: null,\n      connection: null,\n      setListeners: function setListeners() {\n        _this.ws.connection.addEventListener('open', function (e) {\n          return console.log('ws connection opened');\n        });\n        _this.ws.connection.addEventListener('message', function (e) {\n          console.log('new ws message: ' + e.data);\n          var data = JSON.parse(e.data);\n          switch (data.event) {\n            case 'pic':\n              _this.image.src = data.pic.mask ? data.pic.mask : data.pic.url;\n              _this.editor.classList.remove('hidden');\n              _this.loader.classList.add('hidden');\n              break;\n            case 'mask':\n              _this.image.src = data.url;\n              break;\n          }\n        });\n        _this.ws.connection.addEventListener('close', function (e) {\n          return console.log('connection closed');\n        });\n        _this.ws.connection.addEventListener('error', function (e) {\n          return console.log('some ws error: ' + e.data);\n        });\n        // Действия при выходе со страницы\n        window.addEventListener('beforeunload', function (e) {\n          _this.ws.connection.close();\n          _this.connectionOpts.keepConnection = false;\n          if (_this.isHost) {\n            _request.Requests.deleteRoom(requestUrl, _this.roomId);\n          } else {\n            _request.Requests.disconnectRoom(requestUrl, _this.roomId, _this.userId);\n          }\n        });\n      },\n      send: function send() {\n        var image = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.canvasBuffer;\n\n        _this.canvasToImage(_this, false, image).then(function (res) {\n          _this.ws.connection.send(res);\n        }).catch(console.log);\n      }\n    };\n\n    this.init();\n    this.editor.querySelector('#pen').classList.add('selected');\n  }\n\n  _createClass(Canvas, [{\n    key: 'canvasToImage',\n    value: function canvasToImage() {\n      var self = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this;\n\n      var _this2 = this;\n\n      var cleared = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var image = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.canvasBuffer;\n\n      return new Promise(function (resolve) {\n        self.clearCanvas();\n        if (!cleared) {\n          self.ctx.drawImage(image, 0, 0);\n          self.drawBuffered();\n          self.buffer.splice(0, _this2.buffer.length - 1);\n        }\n        self.canvas.toBlob(function (blob) {\n          self.canvasBuffer.src = URL.createObjectURL(blob);\n          resolve(blob);\n        });\n      });\n    }\n  }, {\n    key: 'init',\n    value: function init() {\n      this.loader.classList.remove('hidden');\n      this.buildUsersPanel();\n      this.buildAsideMenu();\n      this.initCanvas();\n    }\n  }, {\n    key: 'buildUsersPanel',\n    value: function buildUsersPanel(users) {\n      var _this3 = this;\n\n      var panel = this.editor.querySelector('.users');\n      panel.textContent = '';\n      var usersWrapper = document.createElement('div');\n      usersWrapper.classList.add('users-wrapper');\n\n      this.users.forEach(function (el) {\n        usersWrapper.appendChild(_this3.buildUser(el, _this3));\n      });\n\n      var userPanelControlls = document.createElement('div');\n      userPanelControlls.classList.add('users__control-btns--wrapper');\n      var closeBtn = document.createElement('button');\n      closeBtn.classList.add('users__control-btn');\n      closeBtn.textContent = 'exit';\n      closeBtn.dataset.btn = 'close';\n      var clearBtn = document.createElement('button');\n      clearBtn.classList.add('users__control-btn');\n      clearBtn.textContent = 'clear';\n      clearBtn.dataset.btn = 'clear';\n\n      this.isHost && userPanelControlls.appendChild(clearBtn);\n      userPanelControlls.appendChild(closeBtn);\n\n      panel.appendChild(usersWrapper);\n      panel.appendChild(userPanelControlls);\n\n      userPanelControlls.addEventListener('click', function (e, self) {\n        return onControllBtnClick(e, _this3);\n      });\n\n      // Действия при нажатии кнопок на панели\n      function onControllBtnClick(e, self) {\n        switch (e.target.dataset.btn) {\n          case 'close':\n            console.log('close');\n            self.exit(self);\n            break;\n          case 'clear':\n            if (self.isHost) {\n              console.log('clear');\n              self.canvasToImage(self, true).then(function (res) {\n                return self.ws.connection.send(res);\n              }).catch(console.log);\n            }\n            break;\n        }\n      }\n    }\n  }, {\n    key: 'buildUser',\n    value: function buildUser(user, self) {\n      var wrapper = document.createElement('div');\n      wrapper.classList.add('user');\n      if (user.userId === self.userId) {\n        wrapper.classList.add('you');\n      }\n\n      var title = document.createElement('h3');\n      title.classList.add('user__title');\n      title.textContent = user.isHost ? 'Host: ' : 'Guest: ';\n\n      var userName = document.createElement('div');\n      userName.classList.add('user__name');\n      userName.textContent = user.name;\n\n      var controlls = document.createElement('div');\n      controlls.classList.add('user__controls');\n      // const togglePermission = document.createElement('button');\n      // togglePermission.classList.add('user__btn');\n      // togglePermission.textContent = 'D';\n      // const removeGuest = document.createElement('button');\n      // removeGuest.classList.add('user__btn');\n      // removeGuest.textContent = 'X';\n      // controlls.appendChild(togglePermission);\n      // controlls.appendChild(removeGuest);\n\n      var permissions = document.createElement('div');\n      permissions.classList.add('user__permissions');\n      var permissionTitle = document.createElement('div');\n      permissionTitle.classList.add('user__permission-title');\n      permissionTitle.textContent = 'Drawing';\n      var permissionStatus = document.createElement('div');\n      permissionStatus.classList.add('user__permission-status');\n      permissionStatus.classList.add('status-accepted');\n      permissions.appendChild(permissionTitle);\n      permissions.appendChild(permissionStatus);\n\n      wrapper.appendChild(title);\n      wrapper.appendChild(userName);\n      wrapper.appendChild(self.isHost ? controlls : permissions);\n      if (user.isHost) {\n        controlls.style.opacity = 0;\n        permissions.style.opacity = 0;\n      }\n\n      return wrapper;\n    }\n  }, {\n    key: 'buildAsideMenu',\n    value: function buildAsideMenu() {\n      var _this4 = this;\n\n      var aside = this.editor.querySelector('.editor__menu');\n      var tools = ['pen', 'line', 'rectangle', 'ellipse', 'triangle', '', '', ''];\n\n      this.isHost && tools.push('erase');\n\n      var settings = ['lineWidth', 'fillStyle', 'strokeStyle' /*,\n                                                              'backgroundColor'*/\n      ];\n\n      var toolsWrapper = document.createElement('div');\n      toolsWrapper.classList.add('users__tools-wrapper');\n      var settingsWrapper = document.createElement('div');\n      settingsWrapper.classList.add('users__settings-wrapper');\n\n      aside.textContent = '';\n      tools.forEach(function (el) {\n        addAsideElement(toolsWrapper, el, _this4);\n      });\n      settings.forEach(function (el) {\n        addSettingElement(settingsWrapper, el, _this4);\n      });\n\n      var showHideArrow = document.createElement('div');\n      showHideArrow.classList.add('show-hide-arrow');\n\n      aside.appendChild(toolsWrapper);\n      aside.appendChild(settingsWrapper);\n      aside.appendChild(showHideArrow);\n\n      function addAsideElement(wrapper, tool, self) {\n        var element = document.createElement('div');\n        if (tool === '') {\n          element.classList.add('hidden-tool');\n        } else {\n          element.classList.add('tool');\n          element.id = tool;\n          element.addEventListener('click', function (e) {\n            onToolClick(e, self);\n          });\n        }\n        wrapper.appendChild(element);\n      }\n\n      function addSettingElement(wrapper, element, self) {\n        var settingElement = document.createElement('div');\n\n        settingElement.classList.add('setting');\n        settingElement.id = element;\n        settingElement.addEventListener('click', function (e) {\n          onSettingClick(e, self);\n        });\n        var title = document.createElement('div');\n        var name = document.createElement('div');\n        name.classList.add('setting__name');\n        var value = document.createElement('div');\n        value.classList.add('setting__value');\n        //name.textContent = element + ': ';\n\n        switch (element) {\n          case 'lineWidth':\n            var lineWidthPoint = document.createElement('div');\n            lineWidthPoint.classList.add('line-width-point');\n            var widthInput = document.createElement('input');\n            widthInput.classList.add('setting__input');\n            widthInput.value = self.options.lineWidth;\n            widthInput.addEventListener('input', function (e) {\n              return lineWidthInputHandler(e, self, lineWidthPoint);\n            });\n            name.appendChild(lineWidthPoint);\n            value.appendChild(widthInput);\n            break;\n          case 'strokeStyle':\n            //value.textContent = self.options.strokeStyle;\n            value.style.backgroundColor = self.options.strokeStyle;\n            break;\n          case 'fillStyle':\n            //value.textContent = self.options.fillStyle;\n            value.style.backgroundColor = self.options.fillStyle;\n            break;\n          case 'backgroundColor':\n            value.textContent = self.options.backgroundColor;\n            break;\n          default:\n        }\n        title.appendChild(name);\n        title.appendChild(value);\n        settingElement.appendChild(title);\n        wrapper.appendChild(settingElement);\n      }\n\n      function lineWidthInputHandler(e, self, pointView) {\n        var lastItemPattern = /\\d/;\n        var value = e.currentTarget.value;\n        if (value.length < 1) {\n          e.currentTarget.value = 0;\n        } else if (lastItemPattern.test(value[value.length - 1])) {\n          self.options.lineWidth = value;\n          pointView.style.width = value + 'px';\n        } else {\n          e.currentTarget.value = value.slice(0, -1);\n        }\n        if (value.length > 1 && value[0] == 0) {\n          e.currentTarget.value = value.slice(1);\n        }\n      }\n\n      function onToolClick(e, self) {\n        self.editor.querySelector('.selected').classList.remove('selected');\n        self.tool.current = e.currentTarget.id;\n        e.currentTarget.classList.add('selected');\n      }\n\n      function onSettingClick(e, self) {\n        switch (e.currentTarget.id) {\n          case 'lineWidth':\n            var lineWidthInput = aside.querySelector('#lineWidth').querySelector('.setting__input');\n            lineWidthInput.focus();\n            break;\n          case 'strokeStyle':\n          case 'fillStyle':\n          case 'backgroundColor':\n            if (self.editor.querySelector('.option-menu')) aside.removeChild(self.editor.querySelector('.option-menu'));\n            aside.appendChild(self.showOptionMenu(e.currentTarget.id));\n            break;\n          default:\n            if (self.editor.querySelector('.option-menu')) aside.removeChild(self.editor.querySelector('.option-menu'));\n        }\n      }\n    }\n  }, {\n    key: 'showOptionMenu',\n    value: function showOptionMenu(option) {\n      var self = this;\n      var currentOptionBtn = document.getElementById(option);\n      var usersMenu = document.querySelector('.users');\n\n      var colors = ['white', 'black', 'red', 'orange', 'yellow', 'green', 'blue', 'purple'];\n      var wrapper = document.createElement('div');\n      wrapper.classList.add('option-menu');\n      wrapper.dataset.isValid = true;\n      var title = document.createElement('h3');\n      var colorsWrapper = document.createElement('div');\n      colorsWrapper.classList.add('option-menu__colors');\n      var currentColor = document.createElement('div');\n      currentColor.classList.add('option-menu__current-color');\n      setColors(this, option);\n      var optionInput = document.createElement('input');\n      optionInput.classList.add('option-menu__input');\n      optionInput.value = this.options[option];\n      var cansel = document.createElement('button');\n      cansel.classList.add('option-menu__cansel-btn');\n      cansel.textContent = 'Accept';\n      cansel.dataset.btn = 'cansel';\n      var close = document.createElement('button');\n      close.classList.add('option-menu__cansel-btn');\n      close.textContent = 'Cansel';\n      close.dataset.btn = 'close';\n      var currentColorLable = document.createElement('p');\n      currentColorLable.textContent = 'Current color';\n\n      switch (option) {\n        case 'strokeStyle':\n          title.textContent = 'Stroke Color:';\n          wrapper.dataset.type = 'strokeStyle';\n          break;\n        case 'fillStyle':\n          title.textContent = 'Fill Color:';\n          wrapper.dataset.type = 'fillStyle';\n          break;\n        case 'backgroundColor':\n          title.textContent = 'Background Color:';\n          wrapper.dataset.type = 'backgroundColor';\n          break;\n      }\n\n      wrapper.addEventListener('click', function (e) {\n        return onBtnClick(e, self);\n      });\n      wrapper.addEventListener('input', function (e) {\n        return onOptionInput(e, self);\n      });\n\n      wrapper.appendChild(title);\n      wrapper.appendChild(colorsWrapper);\n      wrapper.appendChild(optionInput);\n      wrapper.appendChild(currentColorLable);\n      wrapper.appendChild(currentColor);\n      wrapper.appendChild(cansel);\n      wrapper.appendChild(close);\n      console.log(currentOptionBtn.getBoundingClientRect().y, parseFloat(getComputedStyle(usersMenu).height), currentOptionBtn.offsetHeight);\n\n      return wrapper;\n\n      function onBtnClick(e, self) {\n        var value = currentOptionBtn.querySelector('.setting__value');\n        switch (e.target.dataset.btn) {\n          case 'cansel':\n            setOption(e.currentTarget.dataset.type, optionInput.value, self);\n            e.currentTarget.parentElement.removeChild(e.currentTarget);\n            value.style.backgroundColor = optionInput.value;\n            break;\n          case 'close':\n            console.log('here');\n            console.log(optionInput.value);\n            optionInput.value = value.style.backgroundColor;\n            e.currentTarget.parentElement.removeChild(e.currentTarget);\n            console.log(optionInput.value);\n            break;\n        }\n      }\n\n      function onOptionInput(e, self) {\n        var colorPattern = /^#(\\d|[a-f]|[A-F]){3}$|^#(\\d|[a-f]|[A-F]){6}$/;\n        if (colorPattern.test(optionInput.value)) {\n          //setOption(e.currentTarget.dataset.type, optionInput.value, self);\n          currentColor.style.backgroundColor = optionInput.value;\n          optionInput.style.border = '';\n          e.currentTarget.dataset.isValid = true;\n        } else {\n          optionInput.style.border = '2px solid red';\n          e.currentTarget.dataset.isValid = false;\n        }\n        var okBtn = e.currentTarget.querySelector('.option-menu__cansel-btn');\n        console.log(e.currentTarget.dataset.isValid === 'true');\n        if (e.currentTarget.dataset.isValid === 'true') {\n          okBtn.disabled = false;\n          console.log('disable');\n        } else {\n          console.log('enable');\n          okBtn.disabled = true;\n        }\n\n        //currentOptionBtn.querySelector('.setting__value').textContent = optionInput.value;\n      }\n\n      function setOption(type, value, self) {\n        switch (type) {\n          case 'strokeStyle':\n            self.options.strokeStyle = value;\n            break;\n          case 'fillStyle':\n            self.options.fillStyle = value;\n            break;\n          case 'backgroundColor':\n            self.options.backgroundColor = value;\n            self.canvas.style.backgroundColor = value;\n            self.clearCanvas();\n            console.log(self.options.backgroundColor);\n            break;\n        }\n      }\n\n      function setColors(self, option) {\n        switch (option) {\n          case 'strokeStyle':\n            currentColor.style.backgroundColor = self.options.strokeStyle;\n            break;\n          case 'fillStyle':\n            currentColor.style.backgroundColor = self.options.fillStyle;\n            break;\n        }\n        colors.forEach(function (el) {\n          var color = document.createElement('div');\n          color.classList.add('option-menu__color');\n          color.style.backgroundColor = el;\n          color.dataset.color = el;\n\n          color.addEventListener('click', function (e) {\n            optionInput.value = e.target.dataset.color;\n            var colorsPopup = e.target.parentElement.parentElement;\n            colorsPopup.parentElement.removeChild(colorsPopup);\n            currentColor.style.backgroundColor = e.target.dataset.color;\n            var value = currentOptionBtn.querySelector('.setting__value');\n            //value.textContent = optionInput.value;\n            value.style.backgroundColor = optionInput.value;\n            setOption(option, e.target.dataset.color, self);\n          });\n          colorsWrapper.appendChild(color);\n        });\n      }\n    }\n  }, {\n    key: 'exit',\n    value: function exit() {\n      var self = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this;\n\n      console.log('close');\n      document.querySelector('.rooms').classList.remove('hidden');\n      document.querySelector('.controlls').classList.remove('hidden');\n      document.querySelector('.editor').classList.add('hidden');\n      console.log('roomId: ' + self.roomId);\n      self.ws.connection.close();\n      if (!self.isHost) {\n        _request.Requests.disconnectRoom(requestUrl, self.roomId, self.userId);\n      } else {\n        _request.Requests.deleteRoom(requestUrl, self.roomId);\n      }\n      self.connectionOpts.keepConnection = false;\n      self = null;\n    }\n  }, {\n    key: 'initCanvas',\n    value: function initCanvas() {\n      var _this5 = this;\n\n      var canvas = this.canvas;\n      var coords = this.coords;\n      var tool = this.tool;\n      var drawOpts = this.drawOpts;\n      var self = this;\n      var draw = this.draw;\n      var ws = this.ws;\n\n      // Размеры  канвы, за вычетом верхней и боковой панелей\n      canvas.width = this.canvasWidth;\n      canvas.height = this.canvasHeight;\n      window.addEventListener('resize', onCanvasResize.bind(this));\n      console.log(canvas);\n      this.clearCanvas();\n      canvas.style.backgroundColor = this.options.backgroundColor;\n      this.image.style.left = this.canvas.getBoundingClientRect().left + 'px';\n      console.log(this.canvas.getBoundingClientRect().left);\n\n      // Посылаем POST запрос на сервер http://neto-api.herokuapp.com/pic\n      // Тело запроса - формдата, с полями title, image(название, изображение)\n      // В ответе приходит id изображения, записать в imageId конкретной комнаты\n      if (this.isHost) {\n        this.canvasToImage().then(function (res) {\n          return _request.Requests.newImage(imageUrl, res, _this5.host).then(function (res) {\n            _this5.imageId = res.id;\n            _request.Requests.setImageId(requestUrl, _this5.roomId, _this5.imageId).then(console.log).catch(console.log);\n            console.log('connecting to ws server...');\n            ws.url = 'wss://neto-api.herokuapp.com/pic/' + _this5.imageId;\n            ws.connection = new WebSocket(ws.url);\n            ws.setListeners();\n          });\n        }).catch(console.log);\n      } else {\n        ws.url = 'wss://neto-api.herokuapp.com/pic/' + this.imageId;\n        ws.connection = new WebSocket(ws.url);\n        ws.setListeners();\n      }\n      // Открываем поддерживаемое соединение с сервером управления комнатами\n      // И поддерживаем, пока комната существует, иначе данные о комнате удаляются\n      var onConnectionMsg = function onConnectionMsg(self) {\n        var currentUsers = self.users;\n        var buildUser = self.buildUser;\n        var exit = function exit() {\n          self.exit(self);\n        };\n        var buildUsersPanel = function buildUsersPanel(users) {\n          // Удаляем пользователей на панели и помещаем новых\n          var usersWrapper = document.querySelector('.users-wrapper');\n          usersWrapper.textContent = '';\n          users.forEach(function (user) {\n            usersWrapper.appendChild(buildUser(user, self));\n          });\n          self.users = users;\n          currentUsers = users;\n        };\n        return function (res) {\n          // Сравниваем массивы с пользователями, если различаются, перестраиваем панель\n          // Если комната, в которой находится пользователь прекратила свое существование\n          // Закрываем комнату.\n          if (res.msg === 'closed') {\n            exit();\n          } else {\n            console.log(res.users);\n            var newUsers = res.users;\n            console.log(currentUsers);\n            if (newUsers[newUsers.length - 1].userId !== currentUsers[currentUsers.length - 1].userId) {\n              console.log('users changed');\n              buildUsersPanel(newUsers);\n            } else {\n              console.log('no changes');\n            }\n          }\n        };\n      };\n      _request.Requests.keepConnection(this.connectionOpts, onConnectionMsg(this));\n\n      canvas.addEventListener('mousedown', onMouseDown);\n      canvas.addEventListener('mouseup', onMouseUp);\n\n      function onCanvasResize(e) {\n        console.log('resize');\n        this.canvasWidth = window.innerWidth;\n        this.canvasHeight = window.innerHeight * 91 / 100;\n        this.canvas.height = this.canvasHeight;\n        this.canvas.width = this.canvasWidth;\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      }\n\n      function onMouseDown(e) {\n        canvas.addEventListener('mousemove', onMouseMove);\n        drawOpts.isLastPoint = false;\n        drawOpts.isFirstPoint = true;\n\n        var canvasBoundingRect = canvas.getBoundingClientRect();\n        coords.x1 = Math.round(e.pageX - canvasBoundingRect.x);\n        coords.y1 = Math.round(e.pageY - canvasBoundingRect.y);\n\n        draw(tool.current, self);\n        drawOpts.isFirstPoint = false;\n      }\n\n      function onMouseMove(e) {\n        var canvasBoundingRect = canvas.getBoundingClientRect();\n        coords.xCur = Math.round(e.pageX - canvasBoundingRect.x);\n        coords.yCur = Math.round(e.pageY - canvasBoundingRect.y);\n        draw(tool.current, self);\n        console.log(e.pageX, e.pageY);\n      }\n\n      function onMouseUp(e) {\n        canvas.removeEventListener('mousemove', onMouseMove);\n        var canvasBoundingRect = canvas.getBoundingClientRect();\n        coords.x2 = Math.round(e.pageX - canvasBoundingRect.x);\n        coords.y2 = Math.round(e.pageY - canvasBoundingRect.y);\n\n        drawOpts.isLastPoint = true;\n        draw(tool.current, self);\n      }\n    }\n  }, {\n    key: 'clearCanvas',\n    value: function clearCanvas() {\n      var ctx = this.ctx;\n      var canvas = this.canvas;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    }\n  }, {\n    key: 'draw',\n    value: function draw(tool, self) {\n      if (self.ableToDraw) {\n        switch (tool) {\n          case 'pen':\n            self.drawPoint();\n            break;\n          case 'line':\n            self.drawLine();\n            break;\n          case 'rectangle':\n            self.drawRect();\n            break;\n          case 'ellipse':\n            self.drawEllipse();\n            break;\n          case 'triangle':\n            self.drawTriangle();\n            break;\n          case 'erase':\n            self.erase();\n            break;\n        }\n      }\n    }\n  }, {\n    key: 'drawBuffered',\n    value: function drawBuffered() {\n      var buffer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.buffer;\n\n      var ctx = this.ctx;\n      if (buffer.length > 0) {\n        for (var i = 0; i < buffer.length; i++) {\n          switch (buffer[i].type) {\n            case 'point':\n              if (buffer[i].pos === 'first' || i === 0 && (buffer[i].pos === 'last' || buffer[i].pos === 'reg')) {\n                ctx.beginPath();\n                ctx.moveTo(buffer[i].x, buffer[i].y);\n              } else {\n                ctx.lineTo(buffer[i].x, buffer[i].y);\n                ctx.stroke();\n              }\n              break;\n            case 'line':\n              console.log('draw line');\n              if (i !== 0 || buffer[i].isPath || buffer[i].pos === 'first') {\n                if (!buffer[i - 1] || buffer[i - 1].type !== 'line') {\n                  ctx.beginPath();\n                  ctx.moveTo(buffer[i].x, buffer[i].y);\n                } else {\n                  if (buffer[i - 1] && buffer[i - 1].pos === 'first' || buffer[i].isPath && buffer[i].pos === 'last') {\n                    ctx.lineTo(buffer[i].x, buffer[i].y);\n                    ctx.stroke();\n                  }\n                }\n                break;\n              }\n            case 'rect':\n              if (buffer[i].isPath || i !== 0) {\n                ctx.beginPath();\n                ctx.rect(buffer[i].x1, buffer[i].y1, buffer[i].x2, buffer[i].y2);\n                ctx.stroke();\n                ctx.fill();\n                ctx.closePath();\n              }\n              break;\n            case 'ellipse':\n              if (buffer[i].isPath || i !== 0) {\n                ctx.beginPath();\n                ctx.ellipse(buffer[i].x, buffer[i].y, buffer[i].dx, buffer[i].dy, 0, 0, 2 * Math.PI);\n                ctx.stroke();\n                ctx.fill();\n                ctx.closePath();\n              }\n              break;\n            case 'triangle':\n              if (buffer[i].isPath || i !== 0) {\n                console.log('draw triangle');\n                ctx.beginPath();\n                ctx.moveTo(buffer[i].x1, buffer[i].y1);\n                ctx.lineTo(buffer[i].x2, buffer[i].y2);\n                ctx.lineTo(buffer[i].x1 - (buffer[i].x2 - buffer[i].x1), buffer[i].y2);\n                ctx.lineTo(buffer[i].x1, buffer[i].y1);\n                ctx.stroke();\n                ctx.fill();\n                ctx.closePath();\n              }\n              break;\n            case 'erase':\n              console.log(buffer);\n              if (buffer[i].pos === 'first' || i === 0 && (buffer[i].pos === 'last' || buffer[i].pos === 'reg')) {\n                ctx.moveTo(buffer[i].x, buffer[i].y);\n              } else {\n                ctx.lineTo(buffer[i].x, buffer[i].y);\n                ctx.save();\n                ctx.strokeStyle = '#000';\n                ctx.globalCompositeOperation = 'destination-out';\n                ctx.lineWidth = buffer[i].lineWidth;\n                ctx.stroke();\n                ctx.restore();\n              }\n              //this.lastBufferItem = 'erase';\n              break;\n          }\n        }\n      }\n    }\n  }, {\n    key: 'setCtxOpts',\n    value: function setCtxOpts(context) {\n      context.strokeStyle = this.options.strokeStyle;\n      context.fillStyle = this.options.fillStyle;\n      context.lineWidth = this.options.lineWidth;\n      context.lineCap = this.options.lineCap;\n      context.lineJoin = this.options.lineJoin;\n    }\n  }, {\n    key: 'drawPoint',\n    value: function drawPoint() {\n      var ctx = this.ctx;\n      var coords = this.coords;\n      var options = this.options;\n\n      if (this.drawOpts.isFirstPoint) {\n        coords.xCur = coords.x1 + options.strokeWidth;\n        coords.yCur = coords.y1 + options.strokeWidth;\n        this.setCtxOpts(ctx);\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        console.log(this.buffer);\n        this.buffer.push({ x: coords.x1, y: coords.y1, type: 'point', pos: 'first' });\n        this.drawBuffered();\n      } else if (!this.drawOpts.isLastPoint) {\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ x: coords.xCur, y: coords.yCur, type: 'point', pos: 'reg' });\n        this.drawBuffered();\n        if (!this.isQueue && this.buffer.length > 20) {\n          this.isQueue = true;\n          console.log('mouse move send');\n          this.ws.send();\n        }\n      } else {\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ x: coords.x2, y: coords.y2, type: 'point', pos: 'last' });\n        this.drawBuffered();\n        if (!this.isQueue) {\n          this.isQueue = true;\n          console.log('mouse up send');\n          this.ws.send();\n        }\n\n        coords.x1 = coords.xCur;\n        coords.y1 = coords.yCur;\n      }\n    }\n  }, {\n    key: 'drawLine',\n    value: function drawLine() {\n      var ctx = this.ctx;\n      var coords = this.coords;\n      var options = this.options;\n\n      if (this.drawOpts.isFirstPoint) {\n        coords.xCur = coords.x1 + options.strokeWidth;\n        coords.yCur = coords.y1 + options.strokeWidth;\n        this.setCtxOpts(ctx);\n      } else if (!this.drawOpts.isLastPoint) {\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        if (this.pathBuffer.length) {\n          this.pathBuffer.splice(0, this.pathBuffer.length);\n        }\n        // При рисовании линии, если в этот момент есть запрос, линия с запроса искажается\n        this.pathBuffer.push({ x: coords.x1, y: coords.y1, type: 'line', isPath: 'true', pos: 'first' });\n        this.pathBuffer.push({ x: coords.xCur, y: coords.yCur, type: 'line', isPath: 'true', pos: 'last' });\n        this.drawBuffered();\n        this.drawBuffered(this.pathBuffer);\n      } else {\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ x: coords.x1, y: coords.y1, type: 'line', pos: 'first' });\n        this.buffer.push({ x: coords.x2, y: coords.y2, type: 'line', pos: 'last' });\n        this.drawBuffered();\n        if (!this.isQueue) {\n          this.isQueue = true;\n          console.log('mouse up send');\n          this.ws.send();\n        }\n      }\n    }\n  }, {\n    key: 'drawRect',\n    value: function drawRect() {\n      var ctx = this.ctx;\n      var coords = this.coords;\n      var options = this.options;\n      var actions = this.actions;\n\n      if (this.drawOpts.isFirstPoint) {\n        coords.xCur = coords.x1 + options.strokeWidth;\n        coords.yCur = coords.y1 + options.strokeWidth;\n        this.setCtxOpts(ctx);\n      } else if (!this.drawOpts.isLastPoint) {\n        this.clearCanvas();\n        ctx.drawImage(this.canvasBuffer, 0, 0);\n        if (this.pathBuffer.length) {\n          this.pathBuffer.splice(0, this.pathBuffer.length);\n        }\n        this.pathBuffer.push({ x1: coords.x1, y1: coords.y1, x2: coords.xCur - coords.x1, y2: coords.yCur - coords.y1, type: 'rect', isPath: true });\n        this.drawBuffered(this.pathBuffer);\n      } else {\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ type: 'rect', pos: 'first' });\n        this.buffer.push({ x1: coords.x1, y1: coords.y1, x2: coords.xCur - coords.x1, y2: coords.yCur - coords.y1, type: 'rect' });\n        this.drawBuffered();\n        if (!this.isQueue) {\n          this.isQueue = true;\n          console.log('mouse up send');\n          this.ws.send();\n        }\n      }\n    }\n  }, {\n    key: 'drawEllipse',\n    value: function drawEllipse() {\n      var ctx = this.ctx;\n      var coords = this.coords;\n      var options = this.options;\n      var actions = this.actions;\n\n      if (this.drawOpts.isFirstPoint) {\n        coords.xCur = coords.x1 + options.strokeWidth;\n        coords.yCur = coords.y1 + options.strokeWidth;\n        this.setCtxOpts(ctx);\n      } else if (!this.drawOpts.isLastPoint) {\n        this.clearCanvas();\n        ctx.drawImage(this.canvasBuffer, 0, 0);\n        if (this.pathBuffer.length) {\n          this.pathBuffer.splice(0, this.pathBuffer.length);\n        }\n        this.pathBuffer.push({ x: coords.x1, y: coords.y1, dx: Math.abs(coords.xCur - coords.x1),\n          dy: Math.abs(coords.yCur - coords.y1), type: 'ellipse', isPath: true });\n        this.drawBuffered(this.pathBuffer);\n      } else {\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ type: 'ellipse', pos: 'first' });\n        this.buffer.push({ x: coords.x1, y: coords.y1, dx: Math.abs(coords.xCur - coords.x1),\n          dy: Math.abs(coords.yCur - coords.y1), type: 'ellipse' });\n        this.drawBuffered();\n        if (!this.isQueue) {\n          this.isQueue = true;\n          console.log('mouse up send');\n          this.ws.send();\n        }\n      }\n    }\n  }, {\n    key: 'drawTriangle',\n    value: function drawTriangle() {\n      var ctx = this.ctx;\n      var coords = this.coords;\n      var options = this.options;\n      var actions = this.actions;\n\n      if (this.drawOpts.isFirstPoint) {\n        coords.xCur = coords.x1 + options.strokeWidth;\n        coords.yCur = coords.y1 + options.strokeWidth;\n        this.setCtxOpts(ctx);\n      } else if (!this.drawOpts.isLastPoint) {\n        this.clearCanvas();\n        ctx.drawImage(this.canvasBuffer, 0, 0);\n        if (this.pathBuffer.length) {\n          this.pathBuffer.splice(0, this.pathBuffer.length);\n        }\n        this.pathBuffer.push({ x1: coords.x1, y1: coords.y1, x2: coords.xCur, y2: coords.yCur, type: 'triangle', isPath: true });\n        this.drawBuffered(this.pathBuffer);\n      } else {\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ type: 'triangle', pos: 'first' });\n        this.buffer.push({ x1: coords.x1, y1: coords.y1, x2: coords.xCur, y2: coords.yCur, type: 'triangle' });\n        this.drawBuffered();\n        if (!this.isQueue) {\n          this.isQueue = true;\n          console.log('mouse up send');\n          this.ws.send();\n        }\n      }\n    }\n  }, {\n    key: 'erase',\n    value: function erase() {\n      var ctx = this.ctx;\n      var coords = this.coords;\n      var options = this.options;\n\n      if (this.drawOpts.isFirstPoint) {\n        coords.xCur = coords.x1 + options.strokeWidth;\n        coords.yCur = coords.y1 + options.strokeWidth;\n        ctx.beginPath();\n        // ctx.moveTo(coords.x1, coords.y1);\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ x: coords.x1, y: coords.y1, type: 'erase', pos: 'first' });\n        this.drawBuffered();\n      } else if (!this.drawOpts.isLastPoint) {\n        // ctx.lineTo(coords.xCur, coords.yCur);\n        // ctx.save();\n        // ctx.strokeStyle = '#000';\n        // ctx.globalCompositeOperation = 'destination-out';\n        // console.log(this.options.lineWidth);\n        // ctx.lineWidth = options.lineWidth;\n        // ctx.stroke();\n        // ctx.restore();\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ x: coords.xCur, y: coords.yCur, type: 'erase', pos: 'reg', lineWidth: options.lineWidth });\n        this.drawBuffered();\n        if (!this.isQueue && this.buffer.length > 20) {\n          this.isQueue = true;\n          console.log('mouse move send');\n          this.ws.send();\n        }\n      } else {\n        // ctx.lineTo(coords.x2, coords.y2);\n        // ctx.save();\n        // ctx.strokeStyle = '#000';\n        // ctx.globalCompositeOperation = 'destination-out';\n        // ctx.lineWidth = options.lineWidth;\n        // ctx.stroke();\n        // ctx.restore();\n\n        // this.ws.send();\n\n        // coords.x1 = coords.xCur;\n        // coords.y1 = coords.yCur;\n        this.clearCanvas();\n        this.ctx.drawImage(this.canvasBuffer, 0, 0);\n        this.buffer.push({ x: coords.x2, y: coords.y2, type: 'erase', pos: 'last', lineWidth: options.lineWidth });\n        this.drawBuffered();\n        if (!this.isQueue) {\n          this.isQueue = true;\n          console.log('mouse up send');\n          this.ws.send();\n        }\n\n        coords.x1 = coords.xCur;\n        coords.y1 = coords.yCur;\n      }\n    }\n  }]);\n\n  return Canvas;\n}();\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// bundle.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ab31f8aec0c5d07ef9c5","'use strict';\n\nexport class Requests {\n  \n  static getRooms(url) {\n    return new Promise((resolve, reject) => {\n      fetch(url)\n        .then(res => {\n          return res.json();\n        })\n        .then(res => {\n          resolve(res);\n        });\n    });\n  }\n\n  static newRoom(url, host, pass = null) {\n    //Request to adding new room\n    return new Promise((resolve, reject) => {\n      const form = new FormData();\n      form.append('host', host);\n      form.append('password', pass);\n      form.append('roomId', generateRandomRoomId('room'));\n\n      fetch(url, {\n        method: 'POST',\n        body: form\n      })\n        .then(res => {\n          return res.json();\n        })\n        .then(res => {\n          resolve(res);\n        });\n\n      function generateRandomRoomId(base) {\n        const rooms = document.querySelectorAll('.room');\n        let isUnick;\n        let randomEnding;\n\n        do {\n          isUnick = true;\n          randomEnding = Math.round(Math.random() * 10000);\n          rooms.forEach(el => {\n            if (el.dataset.roomId === base + randomEnding)\n              isUnick = false;\n          });\n        } while (!isUnick);\n        \n        return base + randomEnding;\n      }\n    });\n  }\n\n  static connectRoom(url, guest, roomId, pass = null) {\n    //Request to connect the room\n    return new Promise((resolve, reject) => {\n      const form = new FormData();\n      form.append('name', guest);\n      form.append('password', pass);\n      form.append('action', 'connect');\n      form.append('roomId', roomId);\n      console.log(url);\n      fetch(url, {\n        method: 'PUT',\n        body: form\n      })\n        .then(res => {\n          return res.json();\n        })\n        .then(res => {\n          resolve(res);\n        });\n    });\n  }\n\n  static disconnectRoom(url, roomId, userId) {\n    //Request to disconnect the room\n    return new Promise((resolve, reject) => {\n      const form = new FormData();\n      form.append('userId', userId);\n      form.append('action', 'disconnect');\n      form.append('roomId', roomId);\n      console.log(url);\n      fetch(url, {\n        method: 'PUT',\n        body: form\n      })\n        .then(res => {\n          return res.json();\n        })\n        .then(res => {\n          resolve(res);\n        });\n    });\n  }\n\n  static deleteRoom(url, roomId) {\n    //Request to delete the room\n    return new Promise((resolve, reject) => {\n      const form = new FormData();\n      form.append('roomId', roomId);\n      console.log(url);\n      fetch(url, {\n        method: 'DELETE',\n        body: form\n      })\n        .then(res => {\n          return res.json();\n        })\n        .then(res => {\n          resolve(res);\n        });\n    });\n  }\n\n  static newImage(url, image, name) {\n    // Посылаем POST запрос на сервер http://neto-api.herokuapp.com/pic\n    // Content-Type: multipart/form-data\n    // Тело запроса - формдата, с полями title, image(название, изображение)\n    // В ответе приходит id изображения, записать в imageId конкретной комнаты\n    // Можно делать данный запрос и передавать в канву в app.js\n    return new Promise((resolve, reject) => {\n      const form = new FormData();\n      form.append('title', name);\n      form.append('image', image);\n      const fetchOpts = {\n        method: 'POST',\n        body: form\n      }\n      fetch(url, fetchOpts)\n        .then(res => {\n          if (res.status === 200)\n            return res.json();\n          else\n            reject(res);\n        })\n        .then(res => {\n          console.log(res);\n          resolve(res);\n        })\n        .catch(reject);\n    });\n  }\n\n  static setImageId(url, roomId, imageId) {\n    return new Promise((resolve, reject) => {\n      const data = new FormData();\n      data.append('roomId', roomId);\n      data.append('imageId', imageId);\n      // const data = JSON.stringify({\n      //   roomId: roomId,\n      //   imageId: imageId\n      // });\n      const fetchOpts = {\n        method: 'PATCH',\n        body: data\n      }\n      fetch(url, fetchOpts)\n        .then(res => res.json())\n        .then(resolve)\n        .catch(reject);\n    });\n  }\n\n  static keepConnection(props, callback) {\n    const { url, roomId, userId } = props;\n    if (props.keepConnection) {\n      return new Promise((resolve, reject) => {\n        console.log('connection request was sent');\n        fetch(`${url}?roomId=${roomId}&userId=${userId}`)\n          .then(res => res.json())\n          .then(res => {\n            this.keepConnection(props, callback);\n            return res;\n          })\n          .then(callback)\n          .catch(reject);\n      });\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/request/request.js","module.exports = {\"hostname\":\"https://afternoon-cove-50884.herokuapp.com\",\"localhost\":\"http://localhost:8080\"}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./config.json\n// module id = 1\n// module chunks = 0","'use strict';\n\nimport './main.scss';\nimport { Room } from './room/room.js';\nimport { Requests } from './request/request.js';\nimport { Popup } from './popup/popup.js';\nimport { Notice } from './notice/notice.js';\nimport { Canvas } from './canvas/canvas';\nimport config from '../config.json';\n\n// Адрес один, тк различаются типом запроса GET POST DELETE\nconst hostname = location.hostname === 'localhost' ? 'http://localhost:3000' : config.hostname ;\nconst requestUrl = hostname + '/rooms';\nconsole.log(requestUrl);\n\nconst root = document.querySelector('#root');\nconst newRoomBtn = document.querySelector(`.new-room--btn`);\nconst roomsList = document.querySelector(`.rooms__list`);\nlet editor = null;\n\nRequests.getRooms(requestUrl)\n  .then(res => {\n    if (res.length) {\n      console.log(res);\n      buildRooms(roomsList, res);\n    }\n    else {\n      document.querySelector('.rooms__title').textContent = 'No Rooms';\n    }\n  })\n  .catch(er => console.log(er));\n\nnewRoomBtn.addEventListener(`click`, onNewRoomBtnClick);\n\n\nfunction buildRooms(wrapper, rooms) {\n  wrapper.textContent = '';\n  rooms.forEach(room => {\n    const roomEl = new Room(room.host, room.roomId, room.users.length - 1, onConnectClick);\n    wrapper.appendChild(roomEl.room);\n  });\n}\n\nfunction onConnectClick(e) {\n  e.preventDefault();\n  const roomId = e.currentTarget.dataset.roomId;\n  if (!e.target.classList.contains('room__connect--btn'))\n    return;\n\n  const popup = new Popup('connectRoom', onPopupSubmitClick, roomId);\n  root.appendChild(popup.popup);\n  document.querySelector('.popup').querySelector('input').focus();\n}\n\nfunction onNewRoomBtnClick(e) {\n  e.preventDefault();\n  const newRoomPopup = new Popup('newRoom', onPopupSubmitClick);\n  root.appendChild(newRoomPopup.popup);\n  document.querySelector('.popup').querySelector('input').focus();\n}\n\nfunction onPopupSubmitClick(e) {\n  e && e.preventDefault();\n  if (!e.target.classList.contains('popup__submit--btn'))\n    return;\n\n  const name = this.querySelector('#nameInput').value;\n  const pass = this.querySelector('#passInput').value;\n  console.log(name, pass);\n\n  if (this.dataset.type === 'newRoom') {\n    //if (name.length > 0) {\n      Requests.newRoom(requestUrl, name, pass)\n        //Создается объект canvas\n        .then(res => {\n          document.querySelector('.rooms').classList.add('hidden');\n          document.querySelector('.controlls').classList.add('hidden');\n          console.log(res.userId);\n          editor = new Canvas(document.querySelector('.editor'), res.host, res.users, name, true, res.roomId, res.userId);\n        })\n        .catch(er => console.log(er));\n    //}\n    //else {\n    //  const notice = new Notice('Empty name', 'You must enter \"Name\" field');\n    //  root.appendChild(notice.notice);\n    //}\n  }\n  else if (this.dataset.type === 'connectRoom') {\n    const roomId = e.currentTarget.dataset.roomId;\n    console.log(roomId);\n    Requests.connectRoom(requestUrl, name, roomId, pass)\n      //Создается объект canvas\n      .then(res => {\n        console.log(res);\n        if (res.msg === 'denied') {\n          console.log('Access denied');\n          const notice = new Notice('Access denied', 'Wrong password');\n          root.appendChild(notice.notice);\n        }\n        else {\n          document.querySelector('.rooms').classList.add('hidden');\n          document.querySelector('.controlls').classList.add('hidden');\n          editor = new Canvas(document.querySelector('.editor'), res.host, res.users, name, false, roomId, res.userId, res.imageId, res.background);\n        }\n      })\n      .catch(er => console.log(er));\n  }\n\n  this.parentElement.removeChild(this);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app.js","'use strict';\n\nimport './room.scss'\n\nexport class Room {\n  constructor(hostName, roomId, guestsCount, eventHandler) {\n    this.hostName = hostName;\n    this.guestsCount = guestsCount;\n    this.roomId = roomId;\n    this.room = null;\n    this.updateRoom(this.guestsCount);\n    this.room.addEventListener(`click`, eventHandler);\n  }\n\n  updateRoom(guestsCount) {\n    this.guestsCount = guestsCount;\n\n    this.room = (() => {\n      const room = document.createElement('div');\n      room.classList.add('room');\n      room.dataset.roomId = this.roomId;\n\n      const host = document.createElement('div');\n      host.classList.add('room__host');\n      host.textContent = `Host: ${this.hostName}`;\n\n      const guests = document.createElement('div');\n      guests.classList.add('room__guests');\n      guests.textContent = `Guests: ${this.guestsCount}`;\n\n      const connect = document.createElement('button');\n      connect.classList.add('room__connect--btn');\n      connect.textContent = 'Connect';\n\n      room.appendChild(host);\n      room.appendChild(guests);\n      room.appendChild(connect);\n\n      return room;\n    })();\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/room/room.js","'use strict';\n\nimport './popup.scss';\n\nexport class Popup {\n  constructor(type, eventHendler, roomId) {\n    this.type = type;\n    this.popup = null;\n    this.roomId = roomId;\n    this.submitButton = null;\n    this.createPopup();\n    this.popup.addEventListener('click', eventHendler);\n  }\n\n  onEnterPress(e) {\n    if (e.code === 'Enter') {\n      this.submitButton.click();\n    }\n  }\n\n  onNameInput(e, submitBtn) {\n    this.submitButton.disabled = false;\n    e.currentTarget.value === '' && (this.submitButton.disabled = true);\n    \n  }\n\n  createPopup() {\n    this.popup = (() => {\n      const popup = document.createElement('div');\n      popup.classList.add('popup');\n      popup.dataset.type = this.type;\n      popup.dataset.roomId = this.roomId;\n\n      const main = document.createElement('div');\n      main.classList.add('popup__main');\n\n      const title = document.createElement('h3');\n      title.classList.add('popup__title');\n      if (this.type === 'newRoom') {\n        title.textContent = 'Creating New Room';\n      }\n      else if (this.type === 'connectRoom') {\n        title.textContent = 'Connecting The Room';\n      }\n\n      const nameWrapper = document.createElement('div');\n      nameWrapper.classList.add('input-wrapper');\n      const nameLabel = document.createElement('label');\n      nameLabel.classList.add('popup__label');\n      nameLabel.setAttribute('for', 'nameInput');\n      nameLabel.textContent = 'Name: ';\n      const nameInput = document.createElement('input');\n      nameInput.classList.add('popup__input');\n      nameInput.id = 'nameInput';\n      nameWrapper.appendChild(nameLabel);\n      nameWrapper.appendChild(nameInput);\n      \n      const passWrapper = document.createElement('div');\n      passWrapper.classList.add('input-wrapper');\n      const passLabel = document.createElement('label');\n      passLabel.classList.add('popup__label');\n      passLabel.setAttribute('for', 'passInput');\n      passLabel.textContent = 'Password: ';\n      const passInput = document.createElement('input');\n      passInput.classList.add('popup__input');\n      passInput.id = 'passInput';\n      passWrapper.appendChild(passLabel);\n      passWrapper.appendChild(passInput);\n\n      const submitButton = document.createElement('button');\n      submitButton.classList.add('popup__submit--btn');\n      submitButton.textContent = 'submit';\n      submitButton.disabled = true;\n      this.submitButton = submitButton;\n\n      nameInput.addEventListener('input', this.onNameInput.bind(this));\n      popup.addEventListener('keyup', this.onEnterPress.bind(this));\n\n      main.appendChild(title);\n      main.appendChild(nameWrapper);\n      main.appendChild(passWrapper);\n      main.appendChild(submitButton);\n      popup.appendChild(main);\n\n      return popup;\n    })();\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/popup/popup.js","import './notice.scss';\n\nclass Notice {\n  constructor (title, text) {\n    this.state = 'appearing';\n    this.title = title;\n    this.text = text;\n    this.notice = this.createNotice();\n    this.addListeners();\n  }\n\n  createNotice () {\n    const notice = document.createElement('section');\n    notice.classList.add('notice');\n    notice.classList.add('notice-appearing');\n    const title = document.createElement('h3');\n    title.classList.add('notice-title');\n    title.textContent = this.title;\n    const text = document.createElement('p');\n    text.classList.add('notice-text');\n    text.textContent = this.text;\n    notice.appendChild(title);\n    notice.appendChild(text);\n    return notice;\n  }\n\n  addListeners () {\n    this.notice.addEventListener('animationend', (e) => {\n      if (this.state === 'appearing') {\n        this.notice.classList.add('notice-hiding');\n        this.state = 'hiding';\n      }\n      else {\n        this.notice.parentElement.removeChild(this.notice);\n        this.notice = null;\n      }\n    });\n  }\n}\n\nexport { Notice };\n\n\n// WEBPACK FOOTER //\n// ./src/notice/notice.js","'use strict';\n\nimport { Requests } from '../request/request.js';\nimport './canvas.scss';\nimport config from '../../config.json';\n\nconst hostname = location.hostname === 'localhost' ? 'http://localhost:3000' : config.hostname ;\nconst requestUrl = hostname + '/rooms';\nconst connectionUrl = hostname + '/connection';\nconst imageUrl = 'https://neto-api.herokuapp.com/pic';\nconst wsUrl = 'wss://neto-api.herokuapp.com/pic';\n\nexport class Canvas {\n  constructor(editorElement, host, users, userName, isHost, roomId, userId, imageId = null, background = '#fff') {\n    this.editor = editorElement;\n    this.host = host;\n    this.users = users;\n    this.userName = userName;\n    this.isHost = isHost;\n    this.ableToDraw = true;\n    this.roomId = roomId;\n    this.userId = userId;\n    this.imageId = imageId;\n    this.loader = document.querySelector('.canvas-loader');\n    this.buffer = [];\n    //this.lastBufferItem = null;\n    this.pathBuffer = [];\n    this.isQueue = false;\n    this.connectionOpts = {\n      url: connectionUrl,\n      roomId: this.roomId,\n      userId: this.userId,\n      keepConnection: true\n    }\n    this.image = this.editor.querySelector('.editor__image');\n    this.image.addEventListener('load', (e) => {\n      this.clearCanvas();\n      console.log('loaded new image');\n      if (this.buffer.length > 1) {\n        this.ws.send(this.image);\n        console.log('img load send');\n      }\n      else {\n        this.canvasToImage(this, false, this.image);\n        this.isQueue = false;\n      }\n    });\n    this.canvasBuffer = new Image();\n    //this.editor.appendChild(this.canvasBuffer);\n    this.canvas = this.editor.querySelector('#canvas');\n    this.ctx = canvas.getContext('2d');\n    this.canvasWidth = window.innerWidth;\n    this.canvasHeight = window.innerHeight * 91 / 100;\n    this.canvasSizeDif = this.canvasWidth / this.canvasHeight;\n    console.log(this.canvasSizeDif);\n    this.drawOpts = {\n      isFirstPoint: true,\n      isLastPoint: false\n    }\n    this.tool = {\n      current: 'pen'\n    };\n    this.coords = {\n      x1: null,\n      y1: null,\n      x2: null,\n      y2: null,\n      xCur: null,\n      yCur: null\n    };\n    this.options = {\n      lineJoin: 'round',\n      lineCap: 'round',\n      lineWidth: 10,\n      strokeStyle: '#000',\n      fillStyle: '#999',\n      backgroundColor: background\n    }\n    this.ws = {\n      url: null,\n      connection: null,\n      setListeners: () => {\n        this.ws.connection.addEventListener('open', e => console.log('ws connection opened'));\n        this.ws.connection.addEventListener('message', e => {\n          console.log(`new ws message: ${e.data}`);\n          const data = JSON.parse(e.data);\n          switch (data.event) {\n            case 'pic':\n              this.image.src = data.pic.mask ? data.pic.mask : data.pic.url;\n              this.editor.classList.remove('hidden');\n              this.loader.classList.add('hidden');\n              break;\n            case 'mask':\n              this.image.src = data.url;\n              break;\n          }\n        });\n        this.ws.connection.addEventListener('close', e => console.log('connection closed'));\n        this.ws.connection.addEventListener('error', e => console.log(`some ws error: ${e.data}`));\n        // Действия при выходе со страницы\n        window.addEventListener('beforeunload', e => {\n          this.ws.connection.close();\n          this.connectionOpts.keepConnection = false;\n          if (this.isHost) {\n            Requests.deleteRoom(requestUrl, this.roomId);\n          }\n          else {\n            Requests.disconnectRoom(requestUrl, this.roomId, this.userId);\n          }\n        });\n      },\n      send: (image = this.canvasBuffer) => {\n        this.canvasToImage(this, false, image)\n          .then(res => {\n            this.ws.connection.send(res);\n          })\n          .catch(console.log);\n      }\n    };\n\n    this.init();\n    this.editor.querySelector('#pen').classList.add('selected');\n  }\n\n  canvasToImage(self = this, cleared = false, image = this.canvasBuffer) {\n    return new Promise((resolve) => {\n      self.clearCanvas();\n      if (!cleared) {\n        self.ctx.drawImage(image, 0, 0);\n        self.drawBuffered();\n        self.buffer.splice(0, this.buffer.length - 1);\n      }\n      self.canvas.toBlob((blob) => {\n        self.canvasBuffer.src = URL.createObjectURL(blob);\n        resolve(blob);\n      });\n    });\n  }\n\n  init() {\n    this.loader.classList.remove('hidden');\n    this.buildUsersPanel();\n    this.buildAsideMenu();\n    this.initCanvas();\n  }\n\n  buildUsersPanel(users) {\n    const panel = this.editor.querySelector('.users');\n    panel.textContent = '';\n    const usersWrapper = document.createElement('div');\n    usersWrapper.classList.add('users-wrapper');\n\n    this.users.forEach(el => {\n      usersWrapper.appendChild(this.buildUser(el, this));\n    });\n\n    const userPanelControlls = document.createElement('div');\n    userPanelControlls.classList.add('users__control-btns--wrapper');\n    const closeBtn = document.createElement('button');\n    closeBtn.classList.add('users__control-btn');\n    closeBtn.textContent = 'exit';\n    closeBtn.dataset.btn = 'close';\n    const clearBtn = document.createElement('button');\n    clearBtn.classList.add('users__control-btn');\n    clearBtn.textContent = 'clear';\n    clearBtn.dataset.btn = 'clear';\n\n    this.isHost && userPanelControlls.appendChild(clearBtn);\n    userPanelControlls.appendChild(closeBtn);\n\n    panel.appendChild(usersWrapper);\n    panel.appendChild(userPanelControlls);\n\n    userPanelControlls.addEventListener('click', (e, self) => onControllBtnClick(e, this));\n\n    // Действия при нажатии кнопок на панели\n    function onControllBtnClick(e, self) {\n      switch (e.target.dataset.btn) {\n        case 'close':\n          console.log('close');\n          self.exit(self);\n          break;\n        case 'clear':\n          if (self.isHost) {\n            console.log('clear');\n            self.canvasToImage(self, true)\n              .then(res => self.ws.connection.send(res))\n              .catch(console.log);\n          }\n          break;\n      }\n    }\n  }\n\n  buildUser(user, self) {\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('user');\n    if (user.userId === self.userId) {\n      wrapper.classList.add('you');\n    }\n\n    const title = document.createElement('h3');\n    title.classList.add('user__title');\n    title.textContent = user.isHost ? 'Host: ' : 'Guest: '\n\n    const userName = document.createElement('div');\n    userName.classList.add('user__name');\n    userName.textContent = user.name;\n\n    const controlls = document.createElement('div');\n    controlls.classList.add('user__controls');\n    // const togglePermission = document.createElement('button');\n    // togglePermission.classList.add('user__btn');\n    // togglePermission.textContent = 'D';\n    // const removeGuest = document.createElement('button');\n    // removeGuest.classList.add('user__btn');\n    // removeGuest.textContent = 'X';\n    // controlls.appendChild(togglePermission);\n    // controlls.appendChild(removeGuest);\n\n    const permissions = document.createElement('div');\n    permissions.classList.add('user__permissions');\n    const permissionTitle = document.createElement('div');\n    permissionTitle.classList.add('user__permission-title');\n    permissionTitle.textContent = 'Drawing';\n    const permissionStatus = document.createElement('div');\n    permissionStatus.classList.add('user__permission-status');\n    permissionStatus.classList.add('status-accepted');\n    permissions.appendChild(permissionTitle);\n    permissions.appendChild(permissionStatus);\n\n    wrapper.appendChild(title);\n    wrapper.appendChild(userName);\n    wrapper.appendChild(self.isHost ? controlls : permissions);\n    if (user.isHost) {\n      controlls.style.opacity = 0;\n      permissions.style.opacity = 0;\n    }\n\n    return wrapper;\n  }\n\n  buildAsideMenu() {\n    const aside = this.editor.querySelector('.editor__menu');\n    const tools = [\n      'pen',        'line',\n      'rectangle',  'ellipse',\n      'triangle',   '',\n      '',           ''\n    ];\n\n    this.isHost && tools.push('erase');\n\n    const settings = [\n      'lineWidth',\n      'fillStyle',  \n      'strokeStyle'/*,\n      'backgroundColor'*/\n    ];\n\n    const toolsWrapper = document.createElement('div');\n    toolsWrapper.classList.add('users__tools-wrapper');\n    const settingsWrapper = document.createElement('div');\n    settingsWrapper.classList.add('users__settings-wrapper');\n\n    aside.textContent = '';\n    tools.forEach(el => {\n      addAsideElement(toolsWrapper, el, this);\n    });\n    settings.forEach(el => {\n      addSettingElement(settingsWrapper, el, this);\n    });\n\n    const showHideArrow = document.createElement('div');\n    showHideArrow.classList.add('show-hide-arrow');\n\n    aside.appendChild(toolsWrapper);\n    aside.appendChild(settingsWrapper);\n    aside.appendChild(showHideArrow);\n\n    function addAsideElement(wrapper, tool, self) {\n      const element = document.createElement('div');\n      if (tool === '') {\n        element.classList.add('hidden-tool');\n      }\n      else {\n        element.classList.add('tool');\n        element.id = tool;\n        element.addEventListener('click', (e) => {\n          onToolClick(e, self);\n        });\n      }\n      wrapper.appendChild(element);\n    }\n\n    function addSettingElement(wrapper, element, self) {\n      const settingElement = document.createElement('div');\n\n      settingElement.classList.add('setting');\n      settingElement.id = element;\n      settingElement.addEventListener('click', (e) => {\n        onSettingClick(e, self);\n      });\n      const title = document.createElement('div');\n      const name = document.createElement('div');\n      name.classList.add('setting__name')\n      const value = document.createElement('div');\n      value.classList.add('setting__value');\n      //name.textContent = element + ': ';\n\n      switch (element) {\n        case 'lineWidth':\n          const lineWidthPoint = document.createElement('div');\n          lineWidthPoint.classList.add('line-width-point');\n          const widthInput = document.createElement('input');\n          widthInput.classList.add('setting__input');\n          widthInput.value = self.options.lineWidth;\n          widthInput.addEventListener('input', \n            (e) => lineWidthInputHandler(e, self, lineWidthPoint)\n          );\n          name.appendChild(lineWidthPoint);\n          value.appendChild(widthInput);\n          break;\n        case 'strokeStyle':\n          //value.textContent = self.options.strokeStyle;\n          value.style.backgroundColor = self.options.strokeStyle;\n          break;\n        case 'fillStyle':\n          //value.textContent = self.options.fillStyle;\n          value.style.backgroundColor = self.options.fillStyle;\n          break;\n        case 'backgroundColor':\n          value.textContent = self.options.backgroundColor;\n          break;\n        default:\n      }\n      title.appendChild(name);\n      title.appendChild(value);\n      settingElement.appendChild(title);\n      wrapper.appendChild(settingElement);\n    }\n\n    function lineWidthInputHandler (e, self, pointView) {\n      const lastItemPattern = /\\d/;\n      const value = e.currentTarget.value;\n      if (value.length < 1) {\n        e.currentTarget.value = 0;\n      }\n      else if (lastItemPattern.test(value[value.length - 1])) {\n        self.options.lineWidth = value;\n        pointView.style.width = value + 'px';\n      }\n      else {\n        e.currentTarget.value = value.slice(0, -1);\n      }    \n      if (value.length > 1 && value[0] == 0) {\n        e.currentTarget.value = value.slice(1);\n      }  \n    }\n\n    function onToolClick(e, self) {\n      self.editor.querySelector('.selected').classList.remove('selected');\n      self.tool.current = e.currentTarget.id;\n      e.currentTarget.classList.add('selected');\n    }\n\n    function onSettingClick(e, self) {\n      switch (e.currentTarget.id) {\n        case 'lineWidth':\n          const lineWidthInput = aside.querySelector('#lineWidth').querySelector('.setting__input');\n          lineWidthInput.focus();\n          break;\n        case 'strokeStyle':\n        case 'fillStyle':\n        case 'backgroundColor':\n          if (self.editor.querySelector('.option-menu'))\n            aside.removeChild(self.editor.querySelector('.option-menu'));\n          aside.appendChild(self.showOptionMenu(e.currentTarget.id));\n          break;\n        default:\n          if (self.editor.querySelector('.option-menu'))\n            aside.removeChild(self.editor.querySelector('.option-menu'));\n      }\n    }\n  }\n\n  showOptionMenu(option) {\n    const self = this;\n    const currentOptionBtn = document.getElementById(option);\n    const usersMenu = document.querySelector('.users');\n\n    const colors = [\n      'white', 'black', 'red', 'orange', \n      'yellow', 'green', 'blue', 'purple'\n    ]\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('option-menu');\n    wrapper.dataset.isValid = true;\n    const title = document.createElement('h3');\n    const colorsWrapper = document.createElement('div');\n    colorsWrapper.classList.add('option-menu__colors');\n    const currentColor = document.createElement('div');\n    currentColor.classList.add('option-menu__current-color');\n    setColors(this, option);\n    const optionInput = document.createElement('input');\n    optionInput.classList.add('option-menu__input');\n    optionInput.value = this.options[option];\n    const cansel = document.createElement('button');\n    cansel.classList.add('option-menu__cansel-btn');\n    cansel.textContent = 'Accept';\n    cansel.dataset.btn = 'cansel';\n    const close = document.createElement('button');\n    close.classList.add('option-menu__cansel-btn');\n    close.textContent = 'Cansel';\n    close.dataset.btn = 'close';\n    const currentColorLable = document.createElement('p');\n    currentColorLable.textContent = 'Current color';\n\n    switch (option) {\n      case 'strokeStyle':\n        title.textContent = 'Stroke Color:';\n        wrapper.dataset.type = 'strokeStyle';\n        break;\n      case 'fillStyle':\n        title.textContent = 'Fill Color:';\n        wrapper.dataset.type = 'fillStyle';\n        break;\n      case 'backgroundColor':\n        title.textContent = 'Background Color:';\n        wrapper.dataset.type = 'backgroundColor';\n        break;\n    }\n\n    wrapper.addEventListener('click', (e) => onBtnClick(e, self));\n    wrapper.addEventListener('input', (e) => onOptionInput(e, self));\n\n    wrapper.appendChild(title);\n    wrapper.appendChild(colorsWrapper);\n    wrapper.appendChild(optionInput);\n    wrapper.appendChild(currentColorLable);\n    wrapper.appendChild(currentColor);\n    wrapper.appendChild(cansel);\n    wrapper.appendChild(close);\n    console.log(currentOptionBtn.getBoundingClientRect().y, parseFloat(getComputedStyle(usersMenu).height), currentOptionBtn.offsetHeight);\n\n    return wrapper;\n\n    function onBtnClick(e, self) {\n      const value = currentOptionBtn.querySelector('.setting__value');\n      switch (e.target.dataset.btn) {\n        case 'cansel':\n          setOption(e.currentTarget.dataset.type, optionInput.value, self);\n          e.currentTarget.parentElement.removeChild(e.currentTarget);\n          value.style.backgroundColor = optionInput.value;\n          break;\n        case 'close':\n          console.log('here');\n          console.log(optionInput.value);\n          optionInput.value = value.style.backgroundColor;\n          e.currentTarget.parentElement.removeChild(e.currentTarget);\n          console.log(optionInput.value);\n          break;\n      }\n    }\n\n    function onOptionInput(e, self) {\n      const colorPattern = /^#(\\d|[a-f]|[A-F]){3}$|^#(\\d|[a-f]|[A-F]){6}$/;\n      if (colorPattern.test(optionInput.value)) {\n        //setOption(e.currentTarget.dataset.type, optionInput.value, self);\n        currentColor.style.backgroundColor = optionInput.value;\n        optionInput.style.border = '';\n        e.currentTarget.dataset.isValid = true;\n      }\n      else {\n        optionInput.style.border = '2px solid red';\n        e.currentTarget.dataset.isValid = false;\n      }\n      const okBtn = e.currentTarget.querySelector('.option-menu__cansel-btn');\n      console.log(e.currentTarget.dataset.isValid === 'true');   \n      if (e.currentTarget.dataset.isValid === 'true') {\n        okBtn.disabled = false;\n        console.log('disable');\n      }\n      else {\n        console.log('enable');\n        okBtn.disabled = true;\n      }\n      \n      //currentOptionBtn.querySelector('.setting__value').textContent = optionInput.value;\n    }\n\n    function setOption(type, value, self) {\n      switch (type) {\n        case 'strokeStyle':\n          self.options.strokeStyle = value;\n          break;\n        case 'fillStyle':\n          self.options.fillStyle = value;\n          break;\n        case 'backgroundColor':\n          self.options.backgroundColor = value;\n          self.canvas.style.backgroundColor = value;\n          self.clearCanvas();\n          console.log(self.options.backgroundColor);\n          break;\n      }\n    }\n\n    function setColors(self, option) {\n      switch (option) {\n        case 'strokeStyle':\n          currentColor.style.backgroundColor = self.options.strokeStyle;\n          break;\n        case 'fillStyle':\n          currentColor.style.backgroundColor = self.options.fillStyle;\n          break;\n      }\n      colors.forEach(el => {\n        const color = document.createElement('div');\n        color.classList.add('option-menu__color');\n        color.style.backgroundColor = el;\n        color.dataset.color = el;\n        \n        color.addEventListener('click', (e) => {\n          optionInput.value = e.target.dataset.color;\n          const colorsPopup = e.target.parentElement.parentElement\n          colorsPopup.parentElement.removeChild(colorsPopup);\n          currentColor.style.backgroundColor = e.target.dataset.color;\n          const value = currentOptionBtn.querySelector('.setting__value');\n          //value.textContent = optionInput.value;\n          value.style.backgroundColor = optionInput.value;\n          setOption(option, e.target.dataset.color, self);\n        });\n        colorsWrapper.appendChild(color);\n      });\n    }\n  }\n\n  exit(self = this) {\n    console.log('close');\n    document.querySelector('.rooms').classList.remove('hidden');\n    document.querySelector('.controlls').classList.remove('hidden');\n    document.querySelector('.editor').classList.add('hidden');\n    console.log('roomId: ' + self.roomId);\n    self.ws.connection.close();\n    if (!self.isHost) {\n      Requests.disconnectRoom(requestUrl, self.roomId, self.userId);\n    }\n    else {\n      Requests.deleteRoom(requestUrl, self.roomId);\n    }\n    self.connectionOpts.keepConnection = false;\n    self = null;\n  }\n\n  initCanvas() {\n    const canvas = this.canvas;\n    const coords = this.coords;\n    const tool = this.tool;\n    const drawOpts = this.drawOpts;\n    const self = this;\n    const draw = this.draw;\n    const ws = this.ws;\n\n    // Размеры  канвы, за вычетом верхней и боковой панелей\n    canvas.width = this.canvasWidth;\n    canvas.height = this.canvasHeight;\n    window.addEventListener('resize', onCanvasResize.bind(this));\n    console.log(canvas);\n    this.clearCanvas();\n    canvas.style.backgroundColor = this.options.backgroundColor;\n    this.image.style.left = this.canvas.getBoundingClientRect().left + 'px';\n    console.log(this.canvas.getBoundingClientRect().left);\n\n    // Посылаем POST запрос на сервер http://neto-api.herokuapp.com/pic\n    // Тело запроса - формдата, с полями title, image(название, изображение)\n    // В ответе приходит id изображения, записать в imageId конкретной комнаты\n    if (this.isHost) {\n      this.canvasToImage()\n        .then(res => Requests.newImage(imageUrl, res, this.host)\n        .then(res => {\n          this.imageId = res.id;\n          Requests.setImageId(requestUrl, this.roomId, this.imageId)\n            .then(console.log)\n            .catch(console.log);\n          console.log('connecting to ws server...');\n          ws.url = `wss://neto-api.herokuapp.com/pic/${this.imageId}`;\n          ws.connection = new WebSocket(ws.url);\n          ws.setListeners();\n        }))\n        .catch(console.log);\n    }\n    else {\n      ws.url = `wss://neto-api.herokuapp.com/pic/${this.imageId}`;\n      ws.connection = new WebSocket(ws.url);\n      ws.setListeners();\n    }\n    // Открываем поддерживаемое соединение с сервером управления комнатами\n    // И поддерживаем, пока комната существует, иначе данные о комнате удаляются\n    const onConnectionMsg = (self) => {\n      let currentUsers = self.users;\n      const buildUser = self.buildUser;\n      const exit = () => {\n        self.exit(self);\n      };\n      const buildUsersPanel = (users) => {\n        // Удаляем пользователей на панели и помещаем новых\n        const usersWrapper = document.querySelector('.users-wrapper');\n        usersWrapper.textContent = '';\n        users.forEach(user => {\n          usersWrapper.appendChild(buildUser(user, self));\n        });\n        self.users = users;\n        currentUsers = users;\n      };\n      return (res) => {\n        // Сравниваем массивы с пользователями, если различаются, перестраиваем панель\n        // Если комната, в которой находится пользователь прекратила свое существование\n        // Закрываем комнату.\n        if (res.msg === 'closed') {\n          exit();\n        }\n        else {\n          console.log(res.users);\n          const newUsers = res.users;\n          console.log(currentUsers);\n          if (newUsers[newUsers.length - 1].userId !== currentUsers[currentUsers.length - 1].userId) {\n            console.log('users changed');\n            buildUsersPanel(newUsers);\n          }\n          else {\n            console.log('no changes');\n          }\n        }\n      };\n    }\n    Requests.keepConnection(this.connectionOpts, onConnectionMsg(this));\n    \n    canvas.addEventListener('mousedown', onMouseDown);\n    canvas.addEventListener('mouseup', onMouseUp);\n\n    function onCanvasResize(e) {\n      console.log('resize');\n      this.canvasWidth = window.innerWidth;\n      this.canvasHeight = window.innerHeight * 91 / 100;\n      this.canvas.height = this.canvasHeight;\n      this.canvas.width = this.canvasWidth;\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n    }\n\n    function onMouseDown(e) {\n      canvas.addEventListener('mousemove', onMouseMove);\n      drawOpts.isLastPoint = false;\n      drawOpts.isFirstPoint = true;\n\n      const canvasBoundingRect = canvas.getBoundingClientRect();\n      coords.x1 = Math.round(e.pageX - canvasBoundingRect.x);\n      coords.y1 = Math.round(e.pageY - canvasBoundingRect.y);\n\n      draw(tool.current, self);\n      drawOpts.isFirstPoint = false;\n    }\n\n    function onMouseMove(e) {\n      const canvasBoundingRect = canvas.getBoundingClientRect();\n      coords.xCur = Math.round(e.pageX - canvasBoundingRect.x);\n      coords.yCur = Math.round(e.pageY - canvasBoundingRect.y);\n      draw(tool.current, self);\n      console.log(e.pageX, e.pageY);\n    }\n\n    function onMouseUp(e) {\n      canvas.removeEventListener('mousemove', onMouseMove);\n      const canvasBoundingRect = canvas.getBoundingClientRect();\n      coords.x2 = Math.round(e.pageX - canvasBoundingRect.x);\n      coords.y2 = Math.round(e.pageY - canvasBoundingRect.y);\n\n      drawOpts.isLastPoint = true;\n      draw(tool.current, self);\n    }\n  }\n\n  clearCanvas() {\n    const ctx = this.ctx;\n    const canvas = this.canvas;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  draw(tool, self) {\n    if (self.ableToDraw) {\n      switch(tool) {\n        case 'pen':\n          self.drawPoint();\n          break;\n        case 'line':\n          self.drawLine();\n          break;\n        case 'rectangle':\n          self.drawRect();\n          break;\n        case 'ellipse':\n          self.drawEllipse();\n          break;\n        case 'triangle':\n          self.drawTriangle();\n          break;\n        case 'erase':\n          self.erase();\n          break;\n      }\n    }\n  }\n\n  drawBuffered(buffer = this.buffer) {\n    const ctx = this.ctx; \n    if (buffer.length > 0) {\n      for (let i = 0; i < buffer.length; i++) {\n        switch (buffer[i].type) {\n          case 'point':\n            if (buffer[i].pos === 'first' || i === 0 && (buffer[i].pos === 'last' || buffer[i].pos === 'reg')) {\n              ctx.beginPath();\n              ctx.moveTo(buffer[i].x, buffer[i].y);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n            }\n            else {\n              ctx.lineTo(buffer[i].x, buffer[i].y);\n              ctx.stroke();\n            } \n            break;\n          case 'line':\n            console.log('draw line');\n            if (i !== 0 || buffer[i].isPath || buffer[i].pos === 'first') {\n              if (!buffer[i - 1] || buffer[i - 1].type !== 'line') {\n                ctx.beginPath();\n                ctx.moveTo(buffer[i].x, buffer[i].y);\n              }\n              else {\n                if ((buffer[i - 1] && buffer[i - 1].pos === 'first') || \n                   (buffer[i].isPath && buffer[i].pos === 'last'))  {\n                  ctx.lineTo(buffer[i].x, buffer[i].y);\n                  ctx.stroke();\n                }\n              }\n              break;\n            }\n          case 'rect':\n            if (buffer[i].isPath || i !== 0) {\n              ctx.beginPath();\n              ctx.rect(buffer[i].x1, buffer[i].y1, buffer[i].x2, buffer[i].y2);\n              ctx.stroke();\n              ctx.fill();\n              ctx.closePath();\n            }\n            break;\n          case 'ellipse':\n            if (buffer[i].isPath || i !== 0) {\n              ctx.beginPath();\n              ctx.ellipse(buffer[i].x, buffer[i].y, buffer[i].dx, buffer[i].dy, 0, 0, 2 * Math.PI);\n              ctx.stroke();\n              ctx.fill();\n              ctx.closePath();\n            }\n            break;\n          case 'triangle':\n            if (buffer[i].isPath || i !== 0) {\n              console.log('draw triangle');\n              ctx.beginPath();\n              ctx.moveTo(buffer[i].x1, buffer[i].y1);\n              ctx.lineTo(buffer[i].x2, buffer[i].y2);\n              ctx.lineTo(buffer[i].x1 - (buffer[i].x2 - buffer[i].x1), buffer[i].y2);\n              ctx.lineTo(buffer[i].x1, buffer[i].y1);\n              ctx.stroke();\n              ctx.fill();\n              ctx.closePath();\n            }\n            break;\n          case 'erase':\n            console.log(buffer);\n            if (buffer[i].pos === 'first' || i === 0 && (buffer[i].pos === 'last' || buffer[i].pos === 'reg')) {\n              ctx.moveTo(buffer[i].x, buffer[i].y);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n            }\n            else {\n              ctx.lineTo(buffer[i].x, buffer[i].y);\n              ctx.save();\n              ctx.strokeStyle = '#000';\n              ctx.globalCompositeOperation = 'destination-out';\n              ctx.lineWidth = buffer[i].lineWidth;\n              ctx.stroke();\n              ctx.restore();\n            } \n            //this.lastBufferItem = 'erase';\n            break;\n        }\n      }\n    }\n  }\n\n  setCtxOpts(context) {\n    context.strokeStyle = this.options.strokeStyle;\n    context.fillStyle = this.options.fillStyle;\n    context.lineWidth = this.options.lineWidth;\n    context.lineCap = this.options.lineCap;\n    context.lineJoin = this.options.lineJoin;\n  }\n\n  drawPoint() {\n    const ctx = this.ctx;\n    const coords = this.coords;\n    const options = this.options;\n\n    if (this.drawOpts.isFirstPoint) {\n      coords.xCur = coords.x1 + options.strokeWidth;\n      coords.yCur = coords.y1 + options.strokeWidth;\n      this.setCtxOpts(ctx);\n      this.clearCanvas();\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      console.log(this.buffer);\n      this.buffer.push({x: coords.x1, y: coords.y1, type: 'point', pos: 'first'});\n      this.drawBuffered();\n    }\n    else if (!this.drawOpts.isLastPoint) {\n      this.clearCanvas()\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({x: coords.xCur, y: coords.yCur, type: 'point', pos: 'reg'});\n      this.drawBuffered();\n      if (!this.isQueue && this.buffer.length > 20) {\n        this.isQueue = true;\n        console.log('mouse move send');\n        this.ws.send();\n      }\n    }\n    else {\n      this.clearCanvas()\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({x: coords.x2, y: coords.y2, type: 'point', pos: 'last'});\n      this.drawBuffered();\n      if (!this.isQueue) {\n        this.isQueue = true;\n        console.log('mouse up send');\n        this.ws.send();\n      }\n\n      coords.x1 = coords.xCur;\n      coords.y1 = coords.yCur;\n    }\n  }\n\n  drawLine() {\n    const ctx = this.ctx;\n    const coords = this.coords;\n    const options = this.options;\n\n    if (this.drawOpts.isFirstPoint) {\n      coords.xCur = coords.x1 + options.strokeWidth;\n      coords.yCur = coords.y1 + options.strokeWidth;\n      this.setCtxOpts(ctx);\n    }\n    else if (!this.drawOpts.isLastPoint) {\n      this.clearCanvas();\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      if (this.pathBuffer.length) {\n        this.pathBuffer.splice(0, this.pathBuffer.length);\n      }\n      // При рисовании линии, если в этот момент есть запрос, линия с запроса искажается\n      this.pathBuffer.push({x: coords.x1, y: coords.y1, type: 'line', isPath: 'true', pos: 'first'});\n      this.pathBuffer.push({x: coords.xCur, y: coords.yCur, type: 'line', isPath: 'true', pos: 'last'});\n      this.drawBuffered();\n      this.drawBuffered(this.pathBuffer);\n    }\n    else {\n      this.clearCanvas();\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({x: coords.x1, y: coords.y1, type: 'line', pos: 'first'});\n      this.buffer.push({x: coords.x2, y: coords.y2, type: 'line', pos: 'last'});\n      this.drawBuffered();\n      if (!this.isQueue) {\n        this.isQueue = true;\n        console.log('mouse up send');\n        this.ws.send();\n      }\n    }\n  }\n\n  drawRect() {\n    const ctx = this.ctx;\n    const coords = this.coords;\n    const options = this.options;\n    const actions = this.actions;\n\n    if (this.drawOpts.isFirstPoint) {\n      coords.xCur = coords.x1 + options.strokeWidth;\n      coords.yCur = coords.y1 + options.strokeWidth;\n      this.setCtxOpts(ctx);\n    }\n    else if (!this.drawOpts.isLastPoint) {\n      this.clearCanvas();\n      ctx.drawImage(this.canvasBuffer, 0, 0);\n      if (this.pathBuffer.length) {\n        this.pathBuffer.splice(0, this.pathBuffer.length);\n      }\n      this.pathBuffer.push({x1: coords.x1, y1: coords.y1, x2: coords.xCur - coords.x1, y2: coords.yCur - coords.y1, type: 'rect', isPath: true});\n      this.drawBuffered(this.pathBuffer);\n    }\n    else {\n      this.clearCanvas();\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({type: 'rect', pos: 'first'});\n      this.buffer.push({x1: coords.x1, y1: coords.y1, x2: coords.xCur - coords.x1, y2: coords.yCur - coords.y1, type: 'rect'});\n      this.drawBuffered();\n      if (!this.isQueue) {\n        this.isQueue = true;\n        console.log('mouse up send');\n        this.ws.send();\n      }\n    }\n  }\n\n  drawEllipse() {\n    const ctx = this.ctx;\n    const coords = this.coords;\n    const options = this.options;\n    const actions = this.actions;\n\n    if (this.drawOpts.isFirstPoint) {\n      coords.xCur = coords.x1 + options.strokeWidth;\n      coords.yCur = coords.y1 + options.strokeWidth;\n      this.setCtxOpts(ctx);\n    }\n    else if (!this.drawOpts.isLastPoint) {\n      this.clearCanvas();\n      ctx.drawImage(this.canvasBuffer, 0, 0);\n      if (this.pathBuffer.length) {\n        this.pathBuffer.splice(0, this.pathBuffer.length);\n      }\n      this.pathBuffer.push({x: coords.x1, y: coords.y1, dx: Math.abs(coords.xCur - coords.x1), \n                            dy: Math.abs(coords.yCur - coords.y1), type: 'ellipse', isPath: true});\n      this.drawBuffered(this.pathBuffer);\n    }\n    else {\n      this.clearCanvas();\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({type: 'ellipse', pos: 'first'});\n      this.buffer.push({x: coords.x1, y: coords.y1, dx: Math.abs(coords.xCur - coords.x1), \n                        dy: Math.abs(coords.yCur - coords.y1), type: 'ellipse'});\n      this.drawBuffered();\n      if (!this.isQueue) {\n        this.isQueue = true;\n        console.log('mouse up send');\n        this.ws.send();\n      }\n    }\n  }\n\n  drawTriangle() {\n    const ctx = this.ctx;\n    const coords = this.coords;\n    const options = this.options;\n    const actions = this.actions;\n\n    if (this.drawOpts.isFirstPoint) {\n      coords.xCur = coords.x1 + options.strokeWidth;\n      coords.yCur = coords.y1 + options.strokeWidth;\n      this.setCtxOpts(ctx);\n    }\n    else if (!this.drawOpts.isLastPoint) {\n      this.clearCanvas();\n      ctx.drawImage(this.canvasBuffer, 0, 0);\n      if (this.pathBuffer.length) {\n        this.pathBuffer.splice(0, this.pathBuffer.length);\n      }\n      this.pathBuffer.push({x1: coords.x1, y1: coords.y1, x2: coords.xCur, y2: coords.yCur, type: 'triangle', isPath: true});\n      this.drawBuffered(this.pathBuffer);\n    }\n    else {\n      this.clearCanvas();\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({type: 'triangle', pos: 'first'});\n      this.buffer.push({x1: coords.x1, y1: coords.y1, x2: coords.xCur, y2: coords.yCur, type: 'triangle'});\n      this.drawBuffered();\n      if (!this.isQueue) {\n        this.isQueue = true;\n        console.log('mouse up send');\n        this.ws.send();\n      }\n    }\n  }\n\n  erase() {\n    const ctx = this.ctx;\n    const coords = this.coords;\n    const options = this.options;\n\n    if (this.drawOpts.isFirstPoint) {\n      coords.xCur = coords.x1 + options.strokeWidth;\n      coords.yCur = coords.y1 + options.strokeWidth;\n      ctx.beginPath();\n      // ctx.moveTo(coords.x1, coords.y1);\n      this.clearCanvas();\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({x: coords.x1, y: coords.y1, type: 'erase', pos: 'first'});\n      this.drawBuffered();\n    }\n    else if (!this.drawOpts.isLastPoint) {\n      // ctx.lineTo(coords.xCur, coords.yCur);\n      // ctx.save();\n      // ctx.strokeStyle = '#000';\n      // ctx.globalCompositeOperation = 'destination-out';\n      // console.log(this.options.lineWidth);\n      // ctx.lineWidth = options.lineWidth;\n      // ctx.stroke();\n      // ctx.restore();\n      this.clearCanvas()\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({x: coords.xCur, y: coords.yCur, type: 'erase', pos: 'reg', lineWidth: options.lineWidth});\n      this.drawBuffered();\n      if (!this.isQueue && this.buffer.length > 20) {\n        this.isQueue = true;\n        console.log('mouse move send');\n        this.ws.send();\n      }\n    }\n    else {\n      // ctx.lineTo(coords.x2, coords.y2);\n      // ctx.save();\n      // ctx.strokeStyle = '#000';\n      // ctx.globalCompositeOperation = 'destination-out';\n      // ctx.lineWidth = options.lineWidth;\n      // ctx.stroke();\n      // ctx.restore();\n\n      // this.ws.send();\n\n      // coords.x1 = coords.xCur;\n      // coords.y1 = coords.yCur;\n      this.clearCanvas()\n      this.ctx.drawImage(this.canvasBuffer, 0, 0);\n      this.buffer.push({x: coords.x2, y: coords.y2, type: 'erase', pos: 'last', lineWidth: options.lineWidth});\n      this.drawBuffered();\n      if (!this.isQueue) {\n        this.isQueue = true;\n        console.log('mouse up send');\n        this.ws.send();\n      }\n\n      coords.x1 = coords.xCur;\n      coords.y1 = coords.yCur;\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/canvas/canvas.js"],"sourceRoot":""}