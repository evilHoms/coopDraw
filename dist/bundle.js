!function(e){function t(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=2)}([function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();t.Requests=function(){function e(){s(this,e)}return o(e,null,[{key:"getRooms",value:function(e){return new Promise(function(t,n){fetch(e).then(function(e){return e.json()}).then(function(e){t(e)})})}},{key:"newRoom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(s,o){var i=new FormData;i.append("host",t),i.append("password",n),i.append("roomId",function(e){var t=document.querySelectorAll(".room"),n=void 0,s=void 0;do{n=!0,s=Math.round(1e4*Math.random()),t.forEach(function(t){t.dataset.roomId===e+s&&(n=!1)})}while(!n);return e+s}("room")),fetch(e,{method:"POST",body:i}).then(function(e){return e.json()}).then(function(e){s(e)})})}},{key:"connectRoom",value:function(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise(function(o,i){var a=new FormData;a.append("name",t),a.append("password",s),a.append("action","connect"),a.append("roomId",n),console.log(e),fetch(e,{method:"PUT",body:a}).then(function(e){return e.json()}).then(function(e){o(e)})})}},{key:"disconnectRoom",value:function(e,t,n){return new Promise(function(s,o){var i=new FormData;i.append("userId",n),i.append("action","disconnect"),i.append("roomId",t),console.log(e),fetch(e,{method:"PUT",body:i}).then(function(e){return e.json()}).then(function(e){s(e)})})}},{key:"deleteRoom",value:function(e,t){return new Promise(function(n,s){var o=new FormData;o.append("roomId",t),console.log(e),fetch(e,{method:"DELETE",body:o}).then(function(e){return e.json()}).then(function(e){n(e)})})}},{key:"newImage",value:function(e,t,n){return new Promise(function(s,o){var i=new FormData;i.append("title",n),i.append("image",t);var a={method:"POST",body:i};fetch(e,a).then(function(e){if(200===e.status)return e.json();o(e)}).then(function(e){console.log(e),s(e)}).catch(o)})}},{key:"setImageId",value:function(e,t,n){return new Promise(function(s,o){var i=new FormData;i.append("roomId",t),i.append("imageId",n);var a={method:"PATCH",body:i};fetch(e,a).then(function(e){return e.json()}).then(s).catch(o)})}},{key:"keepConnection",value:function(e,t){var n=this,s=e.url,o=e.roomId,i=e.userId;if(e.keepConnection)return new Promise(function(a,r){console.log("connection request was sent"),fetch(s+"?roomId="+o+"&userId="+i).then(function(e){return e.json()}).then(function(s){return n.keepConnection(e,t),s}).then(t).catch(r)})}}]),e}()},function(e,t){e.exports={hostname:"https://afternoon-cove-50884.herokuapp.com",localhost:"http://localhost:8080"}},function(e,t,n){"use strict";function s(e,t){e.textContent="",t.forEach(function(t){var n=new r.Room(t.host,t.roomId,t.users.length-1,o);e.appendChild(n.room)})}function o(e){e.preventDefault();var t=e.currentTarget.dataset.roomId;if(e.target.classList.contains("room__connect--btn")){var n=new u.Popup("connectRoom",a,t);v.appendChild(n.popup),document.querySelector(".popup").querySelector("input").focus()}}function i(e){e.preventDefault();var t=new u.Popup("newRoom",a);v.appendChild(t.popup),document.querySelector(".popup").querySelector("input").focus()}function a(e){if(e&&e.preventDefault(),e.target.classList.contains("popup__submit--btn")){var t=this.querySelector("#nameInput").value,n=this.querySelector("#passInput").value;if(console.log(t,n),"newRoom"===this.dataset.type)c.Requests.newRoom(m,t,n).then(function(e){document.querySelector(".rooms").classList.add("hidden"),document.querySelector(".controlls").classList.add("hidden"),console.log(e.userId),C=new d.Canvas(document.querySelector(".editor"),e.host,e.users,t,!0,e.roomId,e.userId)}).catch(function(e){return console.log(e)});else if("connectRoom"===this.dataset.type){var s=e.currentTarget.dataset.roomId;console.log(s),c.Requests.connectRoom(m,t,s,n).then(function(e){if(console.log(e),"denied"===e.msg){console.log("Access denied");var n=new l.Notice("Access denied","Wrong password");v.appendChild(n.notice)}else document.querySelector(".rooms").classList.add("hidden"),document.querySelector(".controlls").classList.add("hidden"),C=new d.Canvas(document.querySelector(".editor"),e.host,e.users,t,!1,s,e.userId,e.imageId,e.background)}).catch(function(e){return console.log(e)})}this.parentElement.removeChild(this)}}n(3);var r=n(4),c=n(0),u=n(6),l=n(8),d=n(10),h=n(1),p=function(e){return e&&e.__esModule?e:{default:e}}(h),f="localhost"===location.hostname?"http://localhost:3000":p.default.hostname,m=f+"/rooms";console.log(m);var v=document.querySelector("#root"),y=document.querySelector(".new-room--btn"),g=document.querySelector(".rooms__list"),C=null;c.Requests.getRooms(m).then(function(e){e.length?(console.log(e),s(g,e)):document.querySelector(".rooms__title").textContent="No Rooms"}).catch(function(e){return console.log(e)}),y.addEventListener("click",i)},function(e,t){},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();n(5);t.Room=function(){function e(t,n,o,i){s(this,e),this.hostName=t,this.guestsCount=o,this.roomId=n,this.room=null,this.updateRoom(this.guestsCount),this.room.addEventListener("click",i)}return o(e,[{key:"updateRoom",value:function(e){var t=this;this.guestsCount=e,this.room=function(){var e=document.createElement("div");e.classList.add("room"),e.dataset.roomId=t.roomId;var n=document.createElement("div");n.classList.add("room__host"),n.textContent="Host: "+t.hostName;var s=document.createElement("div");s.classList.add("room__guests"),s.textContent="Guests: "+t.guestsCount;var o=document.createElement("button");return o.classList.add("room__connect--btn"),o.textContent="Connect",e.appendChild(n),e.appendChild(s),e.appendChild(o),e}()}}]),e}()},function(e,t){},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();n(7);t.Popup=function(){function e(t,n,o){s(this,e),this.type=t,this.popup=null,this.roomId=o,this.submitButton=null,this.createPopup(),this.popup.addEventListener("click",n)}return o(e,[{key:"onEnterPress",value:function(e){"Enter"===e.code&&this.submitButton.click()}},{key:"onNameInput",value:function(e,t){this.submitButton.disabled=!1,""===e.currentTarget.value&&(this.submitButton.disabled=!0)}},{key:"createPopup",value:function(){var e=this;this.popup=function(){var t=document.createElement("div");t.classList.add("popup"),t.dataset.type=e.type,t.dataset.roomId=e.roomId;var n=document.createElement("div");n.classList.add("popup__main");var s=document.createElement("h3");s.classList.add("popup__title"),"newRoom"===e.type?s.textContent="Creating New Room":"connectRoom"===e.type&&(s.textContent="Connecting The Room");var o=document.createElement("div");o.classList.add("input-wrapper");var i=document.createElement("label");i.classList.add("popup__label"),i.setAttribute("for","nameInput"),i.textContent="Name: ";var a=document.createElement("input");a.classList.add("popup__input"),a.id="nameInput",o.appendChild(i),o.appendChild(a);var r=document.createElement("div");r.classList.add("input-wrapper");var c=document.createElement("label");c.classList.add("popup__label"),c.setAttribute("for","passInput"),c.textContent="Password: ";var u=document.createElement("input");u.classList.add("popup__input"),u.id="passInput",r.appendChild(c),r.appendChild(u);var l=document.createElement("button");return l.classList.add("popup__submit--btn"),l.textContent="submit",l.disabled=!0,e.submitButton=l,a.addEventListener("input",e.onNameInput.bind(e)),t.addEventListener("keyup",e.onEnterPress.bind(e)),n.appendChild(s),n.appendChild(o),n.appendChild(r),n.appendChild(l),t.appendChild(n),t}()}}]),e}()},function(e,t){},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Notice=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();n(9);var i=function(){function e(t,n){s(this,e),this.state="appearing",this.title=t,this.text=n,this.notice=this.createNotice(),this.addListeners()}return o(e,[{key:"createNotice",value:function(){var e=document.createElement("section");e.classList.add("notice"),e.classList.add("notice-appearing");var t=document.createElement("h3");t.classList.add("notice-title"),t.textContent=this.title;var n=document.createElement("p");return n.classList.add("notice-text"),n.textContent=this.text,e.appendChild(t),e.appendChild(n),e}},{key:"addListeners",value:function(){var e=this;this.notice.addEventListener("animationend",function(t){"appearing"===e.state?(e.notice.classList.add("notice-hiding"),e.state="hiding"):(e.notice.parentElement.removeChild(e.notice),e.notice=null)})}}]),e}();t.Notice=i},function(e,t){},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a=n(0),r=n(11),c=s(r);n(12);var u=n(1),l=s(u),d="localhost"===location.hostname?"http://localhost:3000":l.default.hostname,h=d+"/rooms",p=d+"/connection";t.Canvas=function(){function e(t,n,s,i,r,c,u){var l=this,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"#fff";o(this,e),this.editor=t,this.host=n,this.users=s,this.userName=i,this.isHost=r,this.ableToDraw=!0,this.roomId=c,this.userId=u,this.imageId=d,this.loader=document.querySelector(".canvas-loader"),this.buffer=[],this.pathBuffer=[],this.isQueue=!1,this.connectionOpts={url:p,roomId:this.roomId,userId:this.userId,keepConnection:!0},this.image=this.editor.querySelector(".editor__image"),this.image.addEventListener("load",function(e){l.clearCanvas(),console.log("loaded new image"),l.buffer.length>1?(l.ws.send(l.image),console.log("img load send")):(l.canvasToImage(l,!1,l.image),l.isQueue=!1)}),this.canvasBuffer=new Image,this.canvas=this.editor.querySelector("#canvas"),this.ctx=canvas.getContext("2d"),this.canvasWidth=window.innerWidth,this.canvasHeight=91*window.innerHeight/100,this.canvasSizeDif=this.canvasWidth/this.canvasHeight,console.log(this.canvasSizeDif),this.drawOpts={isFirstPoint:!0,isLastPoint:!1},this.tool={current:"pen"},this.coords={x1:null,y1:null,x2:null,y2:null,xCur:null,yCur:null},this.options={lineJoin:"round",lineCap:"round",lineWidth:10,strokeStyle:"#000",fillStyle:"#999",backgroundColor:f},this.ws={url:null,connection:null,setListeners:function(){l.ws.connection.addEventListener("open",function(e){return console.log("ws connection opened")}),l.ws.connection.addEventListener("message",function(e){console.log("new ws message: "+e.data);var t=JSON.parse(e.data);switch(t.event){case"pic":l.image.src=t.pic.mask?t.pic.mask:t.pic.url,l.editor.classList.remove("hidden"),l.loader.classList.add("hidden");break;case"mask":l.image.src=t.url}}),l.ws.connection.addEventListener("close",function(e){return console.log("connection closed")}),l.ws.connection.addEventListener("error",function(e){return console.log("some ws error: "+e.data)}),window.addEventListener("beforeunload",function(e){l.ws.connection.close(),l.connectionOpts.keepConnection=!1,l.isHost?a.Requests.deleteRoom(h,l.roomId):a.Requests.disconnectRoom(h,l.roomId,l.userId)})},send:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.canvasBuffer;l.canvasToImage(l,!1,e).then(function(e){l.ws.connection.send(e)}).catch(console.log)}},this.init(),this.editor.querySelector("#pen").classList.add("selected")}return i(e,[{key:"canvasToImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.canvasBuffer;return new Promise(function(o){e.clearCanvas(),n||(e.ctx.drawImage(s,0,0),e.drawBuffered(),e.buffer.splice(0,t.buffer.length-1)),e.canvas.toBlob(function(t){e.canvasBuffer.src=URL.createObjectURL(t),o(t)})})}},{key:"init",value:function(){this.loader.classList.remove("hidden"),this.buildUsersPanel(),this.buildAsideMenu(),this.initCanvas()}},{key:"buildUsersPanel",value:function(e){function t(e,t){switch(e.target.dataset.btn){case"close":console.log("close"),t.exit(t);break;case"clear":t.isHost&&(console.log("clear"),t.canvasToImage(t,!0).then(function(e){return t.ws.connection.send(e)}).catch(console.log))}}var n=this,s=this.editor.querySelector(".users");s.textContent="";var o=document.createElement("div");o.classList.add("users-wrapper"),this.users.forEach(function(e){o.appendChild(n.buildUser(e,n))});var i=document.createElement("div");i.classList.add("users__control-btns--wrapper");var a=document.createElement("button");a.classList.add("users__control-btn"),a.textContent="exit",a.dataset.btn="close";var r=document.createElement("button");r.classList.add("users__control-btn"),r.textContent="clear",r.dataset.btn="clear",this.isHost&&i.appendChild(r),i.appendChild(a),s.appendChild(o),s.appendChild(i),i.addEventListener("click",function(e,s){return t(e,n)})}},{key:"buildUser",value:function(e,t){var n=document.createElement("div");n.classList.add("user"),e.userId===t.userId&&n.classList.add("you");var s=document.createElement("h3");s.classList.add("user__title"),s.textContent=e.isHost?"Host: ":"Guest: ";var o=document.createElement("div");o.classList.add("user__name"),o.textContent=e.name;var i=document.createElement("div");i.classList.add("user__controls");var a=document.createElement("div");a.classList.add("user__permissions");var r=document.createElement("div");r.classList.add("user__permission-title"),r.textContent="Drawing";var c=document.createElement("div");return c.classList.add("user__permission-status"),c.classList.add("status-accepted"),a.appendChild(r),a.appendChild(c),n.appendChild(s),n.appendChild(o),n.appendChild(t.isHost?i:a),e.isHost&&(i.style.opacity=0,a.style.opacity=0),n}},{key:"buildAsideMenu",value:function(){function e(e){l.catchElement({xMouse:e.pageX,yMouse:e.pageY})}function t(e){l.dropElement({xMouse:e.pageX,yMouse:e.pageY})}function n(e,t,n){var s=document.createElement("div");""===t?s.classList.add("hidden-tool"):(s.classList.add("tool"),s.id=t,s.addEventListener("click",function(e){i(e,n)})),e.appendChild(s)}function s(e,t,n){var s=document.createElement("div");s.classList.add("setting"),s.id=t,s.addEventListener("click",function(e){a(e,n)});var i=document.createElement("div"),r=document.createElement("div");r.classList.add("setting__name");var c=document.createElement("div");switch(c.classList.add("setting__value"),t){case"lineWidth":var u=document.createElement("div");u.classList.add("line-width-point");var l=document.createElement("input");l.classList.add("setting__input"),l.value=n.options.lineWidth,l.addEventListener("input",function(e){return o(e,n,u)}),r.appendChild(u),c.appendChild(l);break;case"strokeStyle":c.style.backgroundColor=n.options.strokeStyle;break;case"fillStyle":c.style.backgroundColor=n.options.fillStyle;break;case"backgroundColor":c.textContent=n.options.backgroundColor}i.appendChild(r),i.appendChild(c),s.appendChild(i),e.appendChild(s)}function o(e,t,n){var s=/^\d+$/,o=e.currentTarget.value;o.length<1?e.currentTarget.value=0:s.test(o)?(t.options.lineWidth=o,n.style.width=o+"px"):e.currentTarget.value=o.replace(/\D/,""),o.length>1&&0==o[0]&&s.test(o)&&(e.currentTarget.value=o.slice(1))}function i(e,t){t.editor.querySelector(".selected").classList.remove("selected"),t.tool.current=e.currentTarget.id,e.currentTarget.classList.add("selected")}function a(e,t){switch(e.currentTarget.id){case"lineWidth":u.querySelector("#lineWidth").querySelector(".setting__input").focus();break;case"strokeStyle":case"fillStyle":case"backgroundColor":t.editor.querySelector(".option-menu")&&u.removeChild(t.editor.querySelector(".option-menu")),u.appendChild(t.showOptionMenu(e.currentTarget.id));break;default:t.editor.querySelector(".option-menu")&&u.removeChild(t.editor.querySelector(".option-menu"))}}var r=this,u=this.editor.querySelector(".editor__menu"),l=new c.default(u),d=["pen","line","rectangle","ellipse","triangle","","",""];this.isHost&&d.push("erase");var h=["lineWidth","fillStyle","strokeStyle"],p=document.createElement("div");p.classList.add("users__tools-wrapper");var f=document.createElement("div");f.classList.add("users__settings-wrapper"),u.textContent="",d.forEach(function(e){n(p,e,r)}),h.forEach(function(e){s(f,e,r)}),u.addEventListener("mousedown",e.bind(this)),u.addEventListener("mouseup",t.bind(this)),u.appendChild(p),u.appendChild(f)}},{key:"showOptionMenu",value:function(e){function t(e,t){var n=i.querySelector(".setting__value");switch(e.target.dataset.btn){case"cansel":s(e.currentTarget.dataset.type,h.value,t),e.currentTarget.parentElement.removeChild(e.currentTarget),n.style.backgroundColor=h.value;break;case"close":console.log("here"),console.log(h.value),h.value=n.style.backgroundColor,e.currentTarget.parentElement.removeChild(e.currentTarget),console.log(h.value)}}function n(e,t){/^#(\d|[a-f]|[A-F]){3}$|^#(\d|[a-f]|[A-F]){6}$/.test(h.value)?(d.style.backgroundColor=h.value,h.style.border="",e.currentTarget.dataset.isValid=!0):(h.style.border="2px solid red",e.currentTarget.dataset.isValid=!1);var n=e.currentTarget.querySelector(".option-menu__cansel-btn");console.log("true"===e.currentTarget.dataset.isValid),"true"===e.currentTarget.dataset.isValid?(n.disabled=!1,console.log("disable")):(console.log("enable"),n.disabled=!0)}function s(e,t,n){switch(e){case"strokeStyle":n.options.strokeStyle=t;break;case"fillStyle":n.options.fillStyle=t;break;case"backgroundColor":n.options.backgroundColor=t,n.canvas.style.backgroundColor=t,n.clearCanvas(),console.log(n.options.backgroundColor)}}var o=this,i=document.getElementById(e),a=document.querySelector(".users"),r=["white","black","red","orange","yellow","green","blue","purple"],c=document.createElement("div");c.classList.add("option-menu"),c.dataset.isValid=!0;var u=document.createElement("h3"),l=document.createElement("div");l.classList.add("option-menu__colors");var d=document.createElement("div");d.classList.add("option-menu__current-color"),function(e,t){switch(t){case"strokeStyle":d.style.backgroundColor=e.options.strokeStyle;break;case"fillStyle":d.style.backgroundColor=e.options.fillStyle}r.forEach(function(n){var o=document.createElement("div");o.classList.add("option-menu__color"),o.style.backgroundColor=n,o.dataset.color=n,o.addEventListener("click",function(n){h.value=n.target.dataset.color;var o=n.target.parentElement.parentElement;o.parentElement.removeChild(o),d.style.backgroundColor=n.target.dataset.color,i.querySelector(".setting__value").style.backgroundColor=h.value,s(t,n.target.dataset.color,e)}),l.appendChild(o)})}(this,e);var h=document.createElement("input");h.classList.add("option-menu__input"),h.value=this.options[e];var p=document.createElement("button");p.classList.add("option-menu__cansel-btn"),p.textContent="Accept",p.dataset.btn="cansel";var f=document.createElement("button");f.classList.add("option-menu__cansel-btn"),f.textContent="Cansel",f.dataset.btn="close";var m=document.createElement("p");switch(m.textContent="Current color",e){case"strokeStyle":u.textContent="Stroke Color:",c.dataset.type="strokeStyle";break;case"fillStyle":u.textContent="Fill Color:",c.dataset.type="fillStyle";break;case"backgroundColor":u.textContent="Background Color:",c.dataset.type="backgroundColor"}return c.addEventListener("click",function(e){return t(e,o)}),c.addEventListener("input",function(e){return n(e,o)}),c.appendChild(u),c.appendChild(l),c.appendChild(h),c.appendChild(m),c.appendChild(d),c.appendChild(p),c.appendChild(f),console.log(i.getBoundingClientRect().y,parseFloat(getComputedStyle(a).height),i.offsetHeight),c}},{key:"exit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;console.log("close"),document.querySelector(".rooms").classList.remove("hidden"),document.querySelector(".controlls").classList.remove("hidden"),document.querySelector(".editor").classList.add("hidden"),console.log("roomId: "+e.roomId),e.ws.connection.close(),e.isHost?a.Requests.deleteRoom(h,e.roomId):a.Requests.disconnectRoom(h,e.roomId,e.userId),e.connectionOpts.keepConnection=!1,e=null}},{key:"initCanvas",value:function(){function e(e){console.log("resize"),this.canvasWidth=window.innerWidth,this.canvasHeight=91*window.innerHeight/100,this.canvas.height=this.canvasHeight,this.canvas.width=this.canvasWidth,this.ctx.drawImage(this.canvasBuffer,0,0)}function t(e){i.addEventListener("mousemove",n),u.isLastPoint=!1,u.isFirstPoint=!0;var t=i.getBoundingClientRect();r.x1=Math.round(e.pageX-t.x),r.y1=Math.round(e.pageY-t.y),d(c.current,l),u.isFirstPoint=!1}function n(e){var t=i.getBoundingClientRect();r.xCur=Math.round(e.pageX-t.x),r.yCur=Math.round(e.pageY-t.y),d(c.current,l),console.log(e.pageX,e.pageY)}function s(e){i.removeEventListener("mousemove",n);var t=i.getBoundingClientRect();r.x2=Math.round(e.pageX-t.x),r.y2=Math.round(e.pageY-t.y),u.isLastPoint=!0,d(c.current,l)}var o=this,i=this.canvas,r=this.coords,c=this.tool,u=this.drawOpts,l=this,d=this.draw,p=this.ws;i.width=this.canvasWidth,i.height=this.canvasHeight,window.addEventListener("resize",e.bind(this)),console.log(i),this.clearCanvas(),i.style.backgroundColor=this.options.backgroundColor,this.image.style.left=this.canvas.getBoundingClientRect().left+"px",console.log(this.canvas.getBoundingClientRect().left),this.isHost?this.canvasToImage().then(function(e){return a.Requests.newImage("https://neto-api.herokuapp.com/pic",e,o.host).then(function(e){o.imageId=e.id,a.Requests.setImageId(h,o.roomId,o.imageId).then(console.log).catch(console.log),console.log("connecting to ws server..."),p.url="wss://neto-api.herokuapp.com/pic/"+o.imageId,p.connection=new WebSocket(p.url),p.setListeners()})}).catch(console.log):(p.url="wss://neto-api.herokuapp.com/pic/"+this.imageId,p.connection=new WebSocket(p.url),p.setListeners());a.Requests.keepConnection(this.connectionOpts,function(e){var t=e.users,n=e.buildUser,s=function(){e.exit(e)},o=function(s){var o=document.querySelector(".users-wrapper");o.textContent="",s.forEach(function(t){o.appendChild(n(t,e))}),e.users=s,t=s};return function(e){if("closed"===e.msg)s();else{console.log(e.users);var n=e.users;console.log(t),n[n.length-1].userId!==t[t.length-1].userId?(console.log("users changed"),o(n)):console.log("no changes")}}}(this)),i.addEventListener("mousedown",t),i.addEventListener("mouseup",s)}},{key:"clearCanvas",value:function(){var e=this.ctx,t=this.canvas;e.clearRect(0,0,t.width,t.height)}},{key:"draw",value:function(e,t){if(t.ableToDraw)switch(e){case"pen":t.drawPoint();break;case"line":t.drawLine();break;case"rectangle":t.drawRect();break;case"ellipse":t.drawEllipse();break;case"triangle":t.drawTriangle();break;case"erase":t.erase()}}},{key:"drawBuffered",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.buffer,t=this.ctx;if(e.length>0)for(var n=0;n<e.length;n++)switch(e[n].type){case"point":"first"===e[n].pos||0===n&&("last"===e[n].pos||"reg"===e[n].pos)?(t.beginPath(),t.moveTo(e[n].x,e[n].y)):(t.lineTo(e[n].x,e[n].y),t.stroke());break;case"line":if(console.log("draw line"),0!==n||e[n].isPath||"first"===e[n].pos){e[n-1]&&"line"===e[n-1].type?(e[n-1]&&"first"===e[n-1].pos||e[n].isPath&&"last"===e[n].pos)&&(t.lineTo(e[n].x,e[n].y),t.stroke()):(t.beginPath(),t.moveTo(e[n].x,e[n].y));break}case"rect":(e[n].isPath||0!==n)&&(t.beginPath(),t.rect(e[n].x1,e[n].y1,e[n].x2,e[n].y2),t.stroke(),t.fill(),t.closePath());break;case"ellipse":(e[n].isPath||0!==n)&&(t.beginPath(),t.ellipse(e[n].x,e[n].y,e[n].dx,e[n].dy,0,0,2*Math.PI),t.stroke(),t.fill(),t.closePath());break;case"triangle":(e[n].isPath||0!==n)&&(console.log("draw triangle"),t.beginPath(),t.moveTo(e[n].x1,e[n].y1),t.lineTo(e[n].x2,e[n].y2),t.lineTo(e[n].x1-(e[n].x2-e[n].x1),e[n].y2),t.lineTo(e[n].x1,e[n].y1),t.stroke(),t.fill(),t.closePath());break;case"erase":console.log(e),"first"===e[n].pos||0===n&&("last"===e[n].pos||"reg"===e[n].pos)?t.moveTo(e[n].x,e[n].y):(t.lineTo(e[n].x,e[n].y),t.save(),t.strokeStyle="#000",t.globalCompositeOperation="destination-out",t.lineWidth=e[n].lineWidth,t.stroke(),t.restore())}}},{key:"setCtxOpts",value:function(e){e.strokeStyle=this.options.strokeStyle,e.fillStyle=this.options.fillStyle,e.lineWidth=this.options.lineWidth,e.lineCap=this.options.lineCap,e.lineJoin=this.options.lineJoin}},{key:"drawPoint",value:function(){var e=this.ctx,t=this.coords,n=this.options;this.drawOpts.isFirstPoint?(t.xCur=t.x1+n.strokeWidth,t.yCur=t.y1+n.strokeWidth,this.setCtxOpts(e),this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),console.log(this.buffer),this.buffer.push({x:t.x1,y:t.y1,type:"point",pos:"first"}),this.drawBuffered()):this.drawOpts.isLastPoint?(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({x:t.x2,y:t.y2,type:"point",pos:"last"}),this.drawBuffered(),this.isQueue||(this.isQueue=!0,console.log("mouse up send"),this.ws.send()),t.x1=t.xCur,t.y1=t.yCur):(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({x:t.xCur,y:t.yCur,type:"point",pos:"reg"}),this.drawBuffered(),!this.isQueue&&this.buffer.length>20&&(this.isQueue=!0,console.log("mouse move send"),this.ws.send()))}},{key:"drawLine",value:function(){var e=this.ctx,t=this.coords,n=this.options;this.drawOpts.isFirstPoint?(t.xCur=t.x1+n.strokeWidth,t.yCur=t.y1+n.strokeWidth,this.setCtxOpts(e)):this.drawOpts.isLastPoint?(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({x:t.x1,y:t.y1,type:"line",pos:"first"}),this.buffer.push({x:t.x2,y:t.y2,type:"line",pos:"last"}),this.drawBuffered(),this.isQueue||(this.isQueue=!0,console.log("mouse up send"),this.ws.send())):(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.pathBuffer.length&&this.pathBuffer.splice(0,this.pathBuffer.length),this.pathBuffer.push({x:t.x1,y:t.y1,type:"line",isPath:"true",pos:"first"}),this.pathBuffer.push({x:t.xCur,y:t.yCur,type:"line",isPath:"true",pos:"last"}),this.drawBuffered(),this.drawBuffered(this.pathBuffer))}},{key:"drawRect",value:function(){var e=this.ctx,t=this.coords,n=this.options;this.actions;this.drawOpts.isFirstPoint?(t.xCur=t.x1+n.strokeWidth,t.yCur=t.y1+n.strokeWidth,this.setCtxOpts(e)):this.drawOpts.isLastPoint?(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({type:"rect",pos:"first"}),this.buffer.push({x1:t.x1,y1:t.y1,x2:t.xCur-t.x1,y2:t.yCur-t.y1,type:"rect"}),this.drawBuffered(),this.isQueue||(this.isQueue=!0,console.log("mouse up send"),this.ws.send())):(this.clearCanvas(),e.drawImage(this.canvasBuffer,0,0),this.pathBuffer.length&&this.pathBuffer.splice(0,this.pathBuffer.length),this.pathBuffer.push({x1:t.x1,y1:t.y1,x2:t.xCur-t.x1,y2:t.yCur-t.y1,type:"rect",isPath:!0}),this.drawBuffered(this.pathBuffer))}},{key:"drawEllipse",value:function(){var e=this.ctx,t=this.coords,n=this.options;this.actions;this.drawOpts.isFirstPoint?(t.xCur=t.x1+n.strokeWidth,t.yCur=t.y1+n.strokeWidth,this.setCtxOpts(e)):this.drawOpts.isLastPoint?(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({type:"ellipse",pos:"first"}),this.buffer.push({x:t.x1,y:t.y1,dx:Math.abs(t.xCur-t.x1),dy:Math.abs(t.yCur-t.y1),type:"ellipse"}),this.drawBuffered(),this.isQueue||(this.isQueue=!0,console.log("mouse up send"),this.ws.send())):(this.clearCanvas(),e.drawImage(this.canvasBuffer,0,0),this.pathBuffer.length&&this.pathBuffer.splice(0,this.pathBuffer.length),this.pathBuffer.push({x:t.x1,y:t.y1,dx:Math.abs(t.xCur-t.x1),dy:Math.abs(t.yCur-t.y1),type:"ellipse",isPath:!0}),this.drawBuffered(this.pathBuffer))}},{key:"drawTriangle",value:function(){var e=this.ctx,t=this.coords,n=this.options;this.actions;this.drawOpts.isFirstPoint?(t.xCur=t.x1+n.strokeWidth,t.yCur=t.y1+n.strokeWidth,this.setCtxOpts(e)):this.drawOpts.isLastPoint?(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({type:"triangle",pos:"first"}),this.buffer.push({x1:t.x1,y1:t.y1,x2:t.xCur,y2:t.yCur,type:"triangle"}),this.drawBuffered(),this.isQueue||(this.isQueue=!0,console.log("mouse up send"),this.ws.send())):(this.clearCanvas(),e.drawImage(this.canvasBuffer,0,0),this.pathBuffer.length&&this.pathBuffer.splice(0,this.pathBuffer.length),this.pathBuffer.push({x1:t.x1,y1:t.y1,x2:t.xCur,y2:t.yCur,type:"triangle",isPath:!0}),this.drawBuffered(this.pathBuffer))}},{key:"erase",value:function(){var e=this.ctx,t=this.coords,n=this.options;this.drawOpts.isFirstPoint?(t.xCur=t.x1+n.strokeWidth,t.yCur=t.y1+n.strokeWidth,e.beginPath(),this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({x:t.x1,y:t.y1,type:"erase",pos:"first"}),this.drawBuffered()):this.drawOpts.isLastPoint?(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({x:t.x2,y:t.y2,type:"erase",pos:"last",lineWidth:n.lineWidth}),this.drawBuffered(),this.isQueue||(this.isQueue=!0,console.log("mouse up send"),this.ws.send()),t.x1=t.xCur,t.y1=t.yCur):(this.clearCanvas(),this.ctx.drawImage(this.canvasBuffer,0,0),this.buffer.push({x:t.xCur,y:t.yCur,type:"erase",pos:"reg",lineWidth:n.lineWidth}),this.drawBuffered(),!this.isQueue&&this.buffer.length>20&&(this.isQueue=!0,console.log("mouse move send"),this.ws.send()))}}]),e}()},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=function(){function e(t){s(this,e),this.element=t,this.xDif=null,this.yDif=null,this.onElementMove=this.onElementMove.bind(this)}return o(e,[{key:"catchElement",value:function(e){var t=e.xMouse,n=e.yMouse,s=this.element;s.dataset.catched=!0,s.style.cursor="all-scroll";var o=parseInt(getComputedStyle(s).left),i=parseInt(getComputedStyle(s).top),a=t,r=n,c=a-o,u=r-i;return this.xDif=c,this.yDif=u,window.addEventListener("mousemove",this.onElementMove),{left:o,top:i}}},{key:"moveElement",value:function(e){var t=e.xMouse,n=e.yMouse,s=this.element;if("true"===s.dataset.catched){var o=this.xDif,i=this.yDif,a=t,r=n;s.style.left=a-o+"px",s.style.top=r-i+"px"}return{left:s.style.left,top:s.style.top}}},{key:"onElementMove",value:function(e){this.moveElement({xMouse:e.pageX,yMouse:e.pageY})}},{key:"dropElement",value:function(e){var t=e.xMouse,n=e.yMouse,s=this.element;s.dataset.catched=!1,s.style.cursor=null;var o=this.xDif,i=this.yDif,a=t,r=n;return s.style.left=a-o+"px",s.style.top=r-i+"px",this.xDif=null,this.yDif=null,window.removeEventListener("mousemove",this.onElementMove),{left:s.style.left,top:s.style.top}}}]),e}();t.default=i},function(e,t){}]);
//# sourceMappingURL=bundle.js.map